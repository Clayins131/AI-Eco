<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>AI Eco</title>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500;700&display=swap"
            rel="stylesheet" />

        <style>
            :root {
                /* UPDATED: Green eco-friendly color scheme */
                --bg-dark: #0a0f1a;
                --bg-panel: rgba(15, 23, 42, 0.45);
                --border: 1px solid rgba(255, 255, 255, 0.08);
                --primary: #3b82f6; /* Blue as primary */
                --primary-light: #60a5fa;
                --primary-dark: #2563eb;
                --accent-earth: #a3825f; /* Earth tone accent */
                --accent-water: #38bdf8; /* Water blue for water-related items */
                --text-main: #f8fafc;
                --text-muted: #94a3b8;
                /* IMPROVED: Higher contrast colors for models - more distinct and vivid */
                --model-mistral: #00d4ff; /* Bright Cyan */
                --model-gpt35: #ff6b35; /* Vivid Orange */
                --model-claude: #10b981; /* Emerald Green */
                --model-gpt4: #8b5cf6; /* Vivid Purple */
                --model-gpt45: #ec4899; /* Hot Pink */
                --model-dalle: #f59e0b; /* Amber */
                /* EU Energy labels */
                --eu-a: #009640;
                --eu-b: #52ae32;
                --eu-c: #c9d200;
                --eu-d: #ffed00;
                --eu-e: #fbba00;
                --eu-f: #ec6608;
                --eu-g: #e30613;
                --font-ui: "Inter", sans-serif;
                --font-mono: "JetBrains Mono", monospace;
                --focus-ring: 0 0 0 3px rgba(59, 130, 246, 0.5);
                --transition-fast: 0.15s ease;
                --transition-normal: 0.3s ease;
            }
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }
            body {
                background-color: var(--bg-dark);
                color: var(--text-main);
                font-family: var(--font-ui);
                height: 100vh;
                overflow: hidden;
                margin: 0;
            }

            /* Accessibility: Focus states for keyboard navigation */
            :focus {
                outline: none;
            }
            :focus-visible {
                box-shadow: var(--focus-ring);
                outline: 2px solid var(--primary);
                outline-offset: 2px;
            }

            /* Skip to main content link for screen readers */
            .skip-link {
                position: absolute;
                top: -40px;
                left: 0;
                background: var(--primary);
                color: #000;
                padding: 8px 16px;
                z-index: 10000;
                font-weight: 600;
                transition: top 0.3s;
            }
            .skip-link:focus {
                top: 0;
            }

            /* Reduced motion preference */
            @media (prefers-reduced-motion: reduce) {
                *,
                *::before,
                *::after {
                    animation-duration: 0.01ms !important;
                    animation-iteration-count: 1 !important;
                    transition-duration: 0.01ms !important;
                }
            }

            /* LANDING - Enhanced with tech theme */
            #landing-layer {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: radial-gradient(ellipse at center, #0a2428 0%, #051315 70%, #000000 100%);
                z-index: 9999;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                transition: opacity 0.8s ease;
                overflow: hidden;
            }
            #landing-layer.hidden {
                opacity: 0;
                pointer-events: none;
            }

            /* Animated particles background */
            #landing-particles {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
            }

            /* Tech grid overlay */
            #landing-layer::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-image: linear-gradient(rgba(59, 130, 246, 0.03) 1px, transparent 1px),
                    linear-gradient(90deg, rgba(59, 130, 246, 0.03) 1px, transparent 1px);
                background-size: 50px 50px;
                animation: gridScroll 20s linear infinite;
                opacity: 0.5;
                pointer-events: none;
                z-index: 1;
            }

            @keyframes gridScroll {
                0% {
                    transform: translateY(0);
                }
                100% {
                    transform: translateY(50px);
                }
            }

            /* Glowing orbs */
            .landing-orb {
                position: absolute;
                border-radius: 50%;
                filter: blur(60px);
                opacity: 0.3;
                animation: float 8s ease-in-out infinite;
                pointer-events: none;
            }
            .landing-orb:nth-child(1) {
                width: 300px;
                height: 300px;
                background: radial-gradient(circle, rgba(59, 130, 246, 0.4), transparent);
                top: 10%;
                left: 20%;
                animation-delay: 0s;
            }
            .landing-orb:nth-child(2) {
                width: 400px;
                height: 400px;
                background: radial-gradient(circle, rgba(37, 99, 235, 0.3), transparent);
                bottom: 15%;
                right: 15%;
                animation-delay: 2s;
            }
            .landing-orb:nth-child(3) {
                width: 250px;
                height: 250px;
                background: radial-gradient(circle, rgba(52, 211, 153, 0.35), transparent);
                top: 50%;
                right: 30%;
                animation-delay: 4s;
            }

            @keyframes float {
                0%,
                100% {
                    transform: translate(0, 0) scale(1);
                }
                33% {
                    transform: translate(30px, -30px) scale(1.1);
                }
                66% {
                    transform: translate(-20px, 20px) scale(0.9);
                }
            }

            /* Enhanced title */
            .landing-title {
                font-size: 4.5rem;
                font-weight: 900;
                color: #fff;
                letter-spacing: -3px;
                margin-bottom: 15px;
                text-shadow:
                    0 0 40px rgba(59, 130, 246, 0.5),
                    0 0 80px rgba(59, 130, 246, 0.3);
                animation: titleGlow 3s ease-in-out infinite;
                position: relative;
                background: linear-gradient(135deg, #ffffff 0%, #60a5fa 50%, #3b82f6 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            @keyframes titleGlow {
                0%,
                100% {
                    filter: brightness(1);
                }
                50% {
                    filter: brightness(1.2);
                }
            }

            .landing-subtitle {
                color: var(--primary);
                font-family: var(--font-mono);
                margin-bottom: 25px;
                font-size: 1rem;
                letter-spacing: 3px;
                text-transform: uppercase;
                animation: pulse 2s ease-in-out infinite;
            }

            @keyframes pulse {
                0%,
                100% {
                    opacity: 0.7;
                }
                50% {
                    opacity: 1;
                }
            }

            .landing-description {
                color: #94a3b8;
                max-width: 500px;
                margin: 0 auto 40px;
                line-height: 1.8;
                font-size: 1.05rem;
            }

            .start-btn {
                background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
                color: #fff;
                border: none;
                padding: 18px 60px;
                font-size: 1.3rem;
                border-radius: 50px;
                cursor: pointer;
                font-weight: 700;
                transition: all 0.3s ease;
                box-shadow:
                    0 0 40px rgba(59, 130, 246, 0.4),
                    0 8px 25px rgba(0, 0, 0, 0.3);
                position: relative;
                overflow: hidden;
                z-index: 100;
            }

            .start-btn::before {
                content: "";
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
                transition: left 0.5s;
            }

            .start-btn:hover::before {
                left: 100%;
            }

            .start-btn:hover {
                transform: translateY(-3px) scale(1.05);
                box-shadow:
                    0 0 60px rgba(59, 130, 246, 0.6),
                    0 12px 35px rgba(0, 0, 0, 0.4);
            }

            .start-btn:active {
                transform: translateY(-1px) scale(1.02);
            }

            /* Scan line effect */
            .scan-line {
                position: absolute;
                width: 100%;
                height: 2px;
                background: linear-gradient(90deg, transparent, var(--primary), transparent);
                top: 0;
                animation: scan 4s linear infinite;
                opacity: 0.3;
                pointer-events: none;
            }

            @keyframes scan {
                0% {
                    top: 0%;
                }
                100% {
                    top: 100%;
                }
            }

            /* Stats/features display */
            .landing-features {
                display: flex;
                gap: 30px;
                margin-top: 40px;
                justify-content: center;
                flex-wrap: wrap;
            }

            .landing-feature {
                background: rgba(59, 130, 246, 0.05);
                border: 1px solid rgba(59, 130, 246, 0.2);
                padding: 15px 25px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                gap: 12px;
                font-size: 0.9rem;
                color: #cbd5e1;
                transition: all 0.3s ease;
            }

            .landing-feature:hover {
                background: rgba(59, 130, 246, 0.1);
                border-color: var(--primary);
                transform: translateY(-2px);
            }

            .landing-feature i {
                color: var(--primary);
                font-size: 1.2rem;
            }

            /* Floating cards animation - icon style, not buttons */
            .floating-card {
                background: transparent;
                border: none;
                padding: 0;
                animation: floatCard 3s ease-in-out infinite;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 8px;
            }
            .floating-card .icon-circle {
                width: 60px;
                height: 60px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            }
            .floating-card .icon-label {
                font-size: 0.75rem;
                color: #94a3b8;
                font-weight: 500;
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            @keyframes floatCard {
                0%,
                100% {
                    transform: translateY(0px);
                }
                50% {
                    transform: translateY(-15px);
                }
            }

            /* Two column layout for landing */
            .landing-grid {
                position: relative;
                z-index: 10;
                display: grid;
                grid-template-columns: 1fr 1fr;
                width: 100%;
                max-width: 1400px;
                height: 100%;
                align-items: center;
                padding: 0 60px;
                gap: 80px;
            }

            .landing-left {
                text-align: left;
            }

            .landing-tag {
                font-size: 1rem;
                color: var(--primary);
                font-weight: 700;
                letter-spacing: 2px;
                margin-bottom: 15px;
                text-transform: uppercase;
            }

            .landing-main-title {
                font-size: 4rem;
                font-weight: 900;
                color: #fff;
                letter-spacing: -2px;
                margin-bottom: 20px;
                line-height: 1.1;
            }

            .landing-gradient-text {
                background: linear-gradient(135deg, var(--primary) 0%, #60a5fa 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .landing-text {
                color: #94a3b8;
                font-size: 1.05rem;
                line-height: 1.7;
                margin-bottom: 30px;
                max-width: 500px;
            }

            .landing-stats {
                display: flex;
                gap: 40px;
                margin-bottom: 40px;
            }

            .landing-stat-value {
                font-size: 2.5rem;
                font-weight: 900;
                color: var(--primary);
                line-height: 1;
            }

            .landing-stat-label {
                font-size: 0.85rem;
                color: #64748b;
                margin-top: 5px;
            }

            .landing-right {
                position: relative;
                display: flex;
                align-items: center;
                justify-content: center;
                height: 600px;
            }

            /* Responsive design for landing */
            @media (max-width: 1024px) {
                .landing-grid {
                    grid-template-columns: 1fr;
                    gap: 40px;
                    padding: 40px 30px;
                }
                .landing-left {
                    text-align: center;
                }
                .landing-main-title {
                    font-size: 3rem;
                }
                .landing-text {
                    margin-left: auto;
                    margin-right: auto;
                }
                .landing-stats {
                    justify-content: center;
                }
                .landing-right {
                    height: 400px;
                }
                .floating-card {
                    display: none;
                }
            }

            @media (max-width: 768px) {
                .landing-title {
                    font-size: 3rem;
                }
                .landing-subtitle {
                    font-size: 0.85rem;
                }
                .landing-description {
                    font-size: 0.95rem;
                    padding: 0 20px;
                }
                .start-btn {
                    padding: 15px 40px;
                    font-size: 1.1rem;
                }
                .landing-features {
                    gap: 15px;
                }
                .landing-feature {
                    padding: 12px 20px;
                    font-size: 0.8rem;
                }
                .landing-orb {
                    display: none; /* Hide orbs on mobile for performance */
                }
                .landing-main-title {
                    font-size: 2.5rem;
                }
                .landing-stats {
                    gap: 20px;
                }
                .landing-stat-value {
                    font-size: 2rem;
                }
            }

            /* APP FRAMEWORK */
            #app-container {
                display: grid;
                grid-template-rows: 60px 1fr;
                height: 100%;
                opacity: 0;
                transition: opacity 1s;
            }
            #app-container.visible {
                opacity: 1;
            }
            header {
                border-bottom: var(--border);
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 0 30px;
                background: rgba(13, 20, 32, 0.95);
                z-index: 20;
            }
            .nav-tabs {
                display: flex;
                gap: 20px;
                height: 100%;
            }
            .nav-btn {
                background: transparent;
                border: none;
                color: var(--text-muted);
                font-weight: 600;
                height: 100%;
                padding: 0 15px;
                cursor: pointer;
                border-bottom: 2px solid transparent;
                transition: 0.3s;
            }
            .nav-btn:hover {
                color: #fff;
                background: rgba(255, 255, 255, 0.05);
            }
            .nav-btn.active {
                color: #fff;
                border-bottom-color: #8ff1b6;
            }

            .layout {
                display: grid;
                grid-template-columns: 340px 1fr;
                height: 100%;
                overflow: hidden;
                transition: grid-template-columns 0.3s ease;
            }
            .layout.sidebar-hidden {
                grid-template-columns: 0 1fr;
            }
            .sidebar {
                background: var(--bg-panel);
                border-right: var(--border);
                padding: 25px;
                display: flex;
                flex-direction: column;
                gap: 25px;
                overflow-y: auto;
                overflow-x: hidden;
                transition:
                    padding 0.3s ease,
                    opacity 0.3s ease;
            }
            .layout.sidebar-hidden .sidebar {
                padding: 0;
                opacity: 0;
                pointer-events: none;
            }

            /* Sidebar toggle button - floating outside menu */
            .sidebar-toggle {
                position: fixed;
                left: 340px;
                top: 50%;
                transform: translateY(-50%);
                z-index: 25;
                background: rgba(15, 23, 42, 0.9);
                border: 1px solid rgba(143, 241, 182, 0.3);
                border-left: none;
                padding: 15px 10px;
                border-radius: 0 12px 12px 0;
                cursor: pointer;
                color: #8ff1b6;
                transition: left 0.3s ease, background 0.3s ease;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
            }
            .sidebar-toggle:hover {
                background: rgba(143, 241, 182, 0.15);
                color: #fff;
                border-color: #8ff1b6;
            }
            .layout.sidebar-hidden .sidebar-toggle {
                left: 0;
            }
            .sidebar-toggle i {
                transition: transform 0.3s ease;
                font-size: 1rem;
            }
            .content {
                padding: 40px;
                overflow-y: auto;
                background: radial-gradient(circle at top right, rgba(13, 20, 32, 0) 0%, rgba(13, 20, 32, 0.95) 70%);
            }

            /* SIDEBAR CONTROLS */
            .control-box {
                background: rgba(255, 255, 255, 0.03);
                padding: 20px;
                border-radius: 12px;
                border: var(--border);
            }
            .slider-label {
                display: flex;
                justify-content: space-between;
                margin-bottom: 10px;
                font-size: 0.8rem;
                font-weight: 600;
            }

            /* Enhanced slider with gradient track - GREEN */
            .slider-container {
                position: relative;
                padding: 25px 0 35px;
            }
            .slider-track-wrapper {
                position: relative;
                width: 100%;
            }
            input[type="range"] {
                width: 100%;
                -webkit-appearance: none;
                height: 10px;
                background: linear-gradient(to right, #1e293b, #8ff1b6);
                border-radius: 5px;
                outline: none;
                cursor: pointer;
                position: relative;
                z-index: 2;
            }
            input[type="range"]::-webkit-slider-thumb {
                -webkit-appearance: none;
                width: 24px;
                height: 24px;
                background: linear-gradient(135deg, #fff, #e0e0e0);
                border-radius: 50%;
                cursor: pointer;
                box-shadow:
                    0 2px 8px rgba(0, 0, 0, 0.4),
                    0 0 0 3px rgba(59, 246, 178, 0.3);
                transition:
                    transform 0.15s,
                    box-shadow 0.15s;
            }
            input[type="range"]::-webkit-slider-thumb:hover {
                transform: scale(1.15);
                box-shadow:
                    0 2px 12px rgba(59, 130, 246, 0.6),
                    0 0 0 4px rgba(59, 130, 246, 0.4);
            }
            input[type="range"]::-webkit-slider-thumb:active {
                transform: scale(1.05);
            }
            input[type="range"]::-moz-range-thumb {
                width: 24px;
                height: 24px;
                background: linear-gradient(135deg, #fff, #e0e0e0);
                border-radius: 50%;
                cursor: pointer;
                border: none;
            }

            /* Snap markers on slider track - improved spacing */
            .snap-markers {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 10px;
                pointer-events: none;
                z-index: 1;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .snap-marker {
                position: absolute;
                width: 3px;
                height: 16px;
                background: rgba(255, 255, 255, 0.4);
                border-radius: 2px;
                transform: translateX(-50%);
                top: -3px;
            }
            .snap-marker::after {
                content: attr(data-value);
                position: absolute;
                top: 24px;
                left: 50%;
                transform: translateX(-50%);
                font-size: 0.55rem;
                color: #64748b;
                white-space: nowrap;
                font-weight: 600;
            }
            .snap-marker.active {
                background: var(--primary);
                box-shadow: 0 0 8px var(--primary);
            }
            .snap-marker.active::after {
                color: var(--primary);
                font-weight: 700;
            }

            /* Editable prompt input */
            .prompt-input-wrapper {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                position: relative;
            }
            .prompt-input {
                background: transparent;
                border: none;
                color: #fff;
                font-size: 2rem;
                font-weight: 800;
                font-family: var(--font-mono);
                text-align: center;
                width: 100px;
                padding: 0;
                outline: none;
                cursor: pointer;
                transition: all 0.2s;
            }
            .prompt-input:hover {
                color: #c9eed8;
            }
            .prompt-input:focus {
                border-bottom: 2px solid var(--primary);
                color: var(--primary);
            }
            .prompt-input::-webkit-inner-spin-button,
            .prompt-input::-webkit-outer-spin-button {
                -webkit-appearance: none;
                appearance: none;
                margin: 0;
            }
            .prompt-input[type="number"] {
                -moz-appearance: textfield;
                appearance: textfield;
            }
            .edit-hint {
                display: flex;
                align-items: center;
                gap: 4px;
                font-size: 0.7rem;
                color: #64748b;
                margin-top: 8px;
                justify-content: center;
            }
            .edit-hint i {
                color: var(--primary);
                animation: pulse-edit 2s infinite;
            }
            @keyframes pulse-edit {
                0%,
                100% {
                    opacity: 0.5;
                }
                50% {
                    opacity: 1;
                }
            }

            /* Help tooltip - GREEN */
            .help-tooltip-trigger {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                width: 18px;
                height: 18px;
                background: rgba(59, 130, 246, 0.2);
                color: var(--primary);
                border-radius: 50%;
                font-size: 0.7rem;
                cursor: help;
                margin-left: 8px;
                position: relative;
                border: none;
            }
            .help-tooltip-trigger:hover {
                background: rgba(59, 130, 246, 0.4);
            }
            .help-tooltip {
                position: absolute;
                bottom: 120%;
                left: 50%;
                transform: translateX(-50%);
                background: #0d1828;
                color: #fff;
                padding: 12px 16px;
                border-radius: 8px;
                font-size: 0.8rem;
                white-space: normal;
                width: 220px;
                z-index: 100;
                border: 1px solid rgba(59, 130, 246, 0.3);
                margin-bottom: 8px;
                opacity: 0;
                visibility: hidden;
                transition:
                    opacity 0.2s,
                    visibility 0.2s;
                text-align: left;
                font-weight: 400;
                line-height: 1.5;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            }
            .help-tooltip::after {
                content: "";
                position: absolute;
                top: 100%;
                left: 50%;
                transform: translateX(-50%);
                border: 6px solid transparent;
                border-top-color: #0d1828;
            }
            .help-tooltip-trigger:hover .help-tooltip,
            .help-tooltip-trigger:focus .help-tooltip {
                opacity: 1;
                visibility: visible;
            }

            /* CHANGED: Prompt display styling - GREEN */
            .prompt-display {
                background: linear-gradient(135deg, rgba(143, 241, 182, 0.15), rgba(143, 241, 182, 0.05));
                border: 1px solid rgba(143, 241, 182, 0.3);
                border-radius: 10px;
                padding: 15px;
                margin-top: 15px;
                text-align: center;
            }
            .prompt-value {
                font-size: 2rem;
                font-weight: 800;
                color: #fff;
                font-family: var(--font-mono);
                line-height: 1;
            }
            .prompt-unit {
                font-size: 0.75rem;
                color: var(--primary);
                font-weight: 600;
                margin-top: 5px;
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            /* Preset buttons - GREEN */
            .preset-btns {
                display: flex;
                gap: 8px;
                margin-top: 12px;
                flex-wrap: wrap;
            }
            .preset-btn {
                flex: 1;
                min-width: 60px;
                padding: 8px 12px;
                background: rgba(255, 255, 255, 0.05);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 8px;
                color: #94a3b8;
                font-size: 0.75rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.2s;
                text-align: center;
            }
            .preset-btn:hover {
                background: rgba(59, 130, 246, 0.15);
                border-color: var(--primary);
                color: #fff;
            }
            .preset-btn.active {
                background: var(--primary);
                color: #000;
                border-color: var(--primary);
            }

            /* Info tooltip box */
            .info-box {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 8px;
                padding: 12px;
                margin-top: 15px;
                border-left: 3px solid var(--primary);
            }
            .info-box-title {
                font-size: 0.7rem;
                color: var(--primary);
                font-weight: 700;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                margin-bottom: 6px;
            }
            .info-box-text {
                font-size: 0.75rem;
                color: #94a3b8;
                line-height: 1.5;
            }

            /* IMPROVED: Model card with info button */
            .model-card {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 12px;
                margin-bottom: 8px;
                background: rgba(255, 255, 255, 0.03);
                border-radius: 8px;
                cursor: pointer;
                transition: 0.2s;
                border: 1px solid transparent;
                position: relative;
            }
            .model-card:hover {
                background: rgba(255, 255, 255, 0.06);
                transform: translateX(4px);
            }
            .model-card.active {
                border-color: #8ff1b6;
                background: rgba(59, 130, 246, 0.1);
            }
            .custom-check {
                width: 18px;
                height: 18px;
                border: 2px solid #64748b;
                border-radius: 4px;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
            }
            .model-card.active .custom-check {
                background: #8ff1b6;
                border-color: #8ff1b6;
            }
            .model-card.active .custom-check::after {
                content: "âœ“";
                font-size: 12px;
                color: #0a1628;
                font-weight: 900;
            }
            .model-color-dot {
                width: 12px;
                height: 12px;
                border-radius: 50%;
                flex-shrink: 0;
                box-shadow: 0 0 8px currentColor;
            }

            /* NEW: Info button for model specs */
            .model-info-btn {
                width: 24px;
                height: 24px;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 50%;
                color: #94a3b8;
                font-size: 0.7rem;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s;
                flex-shrink: 0;
            }
            .model-info-btn:hover {
                background: #8ff1b6;
                color: #000;
                border-color: #8ff1b6;
                transform: scale(1.1);
            }

            /* --- FEATURE 1: INTUITIVE RATING SYSTEM --- */
            .rating-section {
                display: flex;
                gap: 40px;
                margin-bottom: 40px;
                align-items: center;
            }
            .rating-ladder {
                width: 280px;
                display: flex;
                flex-direction: column;
                gap: 6px;
            }
            .rating-bar {
                height: 32px;
                display: flex;
                align-items: center;
                padding-left: 15px;
                color: #fff;
                font-weight: 800;
                font-size: 0.9rem;
                clip-path: polygon(0% 0%, 92% 0%, 100% 50%, 92% 100%, 0% 100%);
                opacity: 0.25;
                transform: scale(0.98);
                transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                border-right: 2px solid rgba(0, 0, 0, 0.5);
            }
            .rating-bar.active {
                opacity: 1;
                transform: scale(1.05) translateX(10px);
                box-shadow: 0 0 25px currentColor;
                z-index: 10;
            }
            .rb-a {
                width: 40%;
                background: var(--eu-a);
                color: white;
            }
            .rb-b {
                width: 50%;
                background: var(--eu-b);
                color: white;
            }
            .rb-c {
                width: 60%;
                background: var(--eu-c);
                color: white;
            }
            .rb-d {
                width: 70%;
                background: var(--eu-d);
                color: black;
            }
            .rb-e {
                width: 80%;
                background: var(--eu-e);
                color: black;
            }
            .rb-f {
                width: 90%;
                background: var(--eu-f);
                color: white;
            }
            .rb-g {
                width: 100%;
                background: var(--eu-g);
                color: white;
            }

            .score-card {
                flex: 0 0 auto;
                background: rgba(255, 255, 255, 0.02);
                border: 1px solid transparent;
                border-radius: 16px;
                padding: 20px;
                transition: 0.4s;
                position: relative;
                overflow: hidden;
                display: flex;
                flex-direction: column;
                justify-content: center;
                cursor: default;
                -webkit-user-select: none;
                user-select: none;
            }
            .score-card::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), transparent);
                pointer-events: none;
            }
            .score-header {
                font-size: 0.7rem;
                color: #94a3b8;
                text-transform: uppercase;
                letter-spacing: 2px;
                margin-bottom: 8px;
                font-weight: 700;
            }
            .score-grade {
                font-size: 1.8rem;
                font-weight: 800;
                line-height: 1.1;
                margin-bottom: 8px;
                transition: 0.3s;
            }
            .score-desc {
                font-size: 1rem;
                font-weight: 700;
                color: #fff;
                margin-bottom: 6px;
                letter-spacing: -0.5px;
            }
            .score-context {
                font-size: 0.85rem;
                color: #cbd5e1;
                line-height: 1.5;
                max-width: 90%;
            }

            /* DASHBOARD CARDS with hover effects */
            .cards-grid {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
                margin-bottom: 30px;
            }
            .impact-card {
                background: rgba(255, 255, 255, 0.02);
                border-radius: 12px;
                padding: 25px;
                border: 1px solid rgba(255, 255, 255, 0.05);
                position: relative;
                overflow: hidden;
                transition: all 0.3s ease;
                cursor: default;
                -webkit-user-select: none;
                user-select: none;
            }
            .impact-card:hover {
                transform: translateY(-4px);
                border-color: rgba(255, 255, 255, 0.15);
                background: rgba(255, 255, 255, 0.04);
            }
            .human-stat {
                font-size: 2rem;
                font-weight: 800;
                color: #fff;
                margin: 10px 0;
                transition: transform 0.3s;
            }
            .impact-card:hover .human-stat {
                transform: scale(1.05);
            }
            .chart-box {
                background: rgba(255, 255, 255, 0.02);
                border-radius: 12px;
                padding: 20px;
                border: var(--border);
                height: 300px;
                display: flex;
                flex-direction: column;
                cursor: default;
                -webkit-user-select: none;
                user-select: none;
            }

            /* IMPROVED: Separate Water/E-waste section with visual distinction - GREEN */
            .environmental-section {
                margin-top: 30px;
                padding: 25px;
                background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(37, 99, 235, 0.05));
                border: 1px solid rgba(59, 130, 246, 0.15);
                border-radius: 16px;
            }
            .environmental-section-title {
                font-size: 1rem;
                font-weight: 700;
                color: #fff;
                margin-bottom: 20px;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .environmental-section-title i {
                color: var(--primary);
            }
            .environmental-cards {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }

            .severity-badge {
                display: inline-flex;
                align-items: center;
                gap: 6px;
                padding: 6px 12px;
                border-radius: 20px;
                font-size: 0.75rem;
                font-weight: 700;
                margin-top: 10px;
            }
            .severity-badge.good {
                background: rgba(0, 150, 64, 0.2);
                color: #4ade80;
            }
            .severity-badge.moderate {
                background: rgba(251, 186, 0, 0.2);
                color: #fbbf24;
            }
            .severity-badge.critical {
                background: rgba(227, 6, 19, 0.2);
                color: #f87171;
            }

            /* Loading indicator */
            .loading-indicator {
                display: none;
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: 1000;
            }
            .loading-indicator.visible {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            .spinner {
                width: 40px;
                height: 40px;
                border: 3px solid rgba(59, 130, 246, 0.2);
                border-top-color: var(--primary);
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            /* Toast notifications for feedback - GREEN */
            .toast-container {
                position: fixed;
                bottom: 30px;
                right: 30px;
                z-index: 1000;
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            .toast {
                background: #0d1828;
                color: #fff;
                padding: 12px 20px;
                border-radius: 8px;
                border-left: 4px solid var(--primary);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
                transform: translateX(120%);
                transition: transform 0.3s ease;
                font-size: 0.9rem;
            }
            .toast.show {
                transform: translateX(0);
            }
            .toast.success {
                border-left-color: var(--eu-a);
            }
            .toast.warning {
                border-left-color: var(--eu-e);
            }
            .toast.error {
                border-left-color: var(--eu-g);
            }

            /* IMPROVED: 3D View Layout - Full Width */
            .bench-layout {
                display: flex;
                flex-direction: column;
                gap: 0;
                min-height: calc(100vh - 180px);
            }
            #three-container {
                width: 100%;
                flex: 1;
                background: #000;
                border-radius: 16px;
                border: 1px solid rgba(255, 255, 255, 0.1);
                position: relative;
                overflow: hidden;
                box-shadow: inset 0 0 80px rgba(0, 0, 0, 0.8);
                min-height: 400px;
                cursor: grab;
            }
            #three-container:active {
                cursor: grabbing;
            }
            .three-controls {
                position: absolute;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                display: flex;
                gap: 15px;
            }
            .t-btn {
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid #8ff1b6;
                color: #fff;
                padding: 10px 20px;
                border-radius: 30px;
                cursor: pointer;
                backdrop-filter: blur(4px);
                font-weight: 600;
                transition: 0.2s;
            }
            .t-btn:hover,
            .t-btn.active {
                background: #fff;
                color: #000;
            }
            .t-btn[style*="background: transparent"]:hover,
            .t-btn[style*="background:transparent"]:hover {
                background: transparent !important;
                color: #fff !important;
            }
            .t-btn[style*="background: transparent"]:hover span:first-child,
            .t-btn[style*="background:transparent"]:hover span:first-child {
                background: rgba(143, 241, 182, 0.3) !important;
                border-color: #8ff1b6 !important;
            }

            /* Impact Details Panel - Collapsible */
            .impact-details-panel {
                background: rgba(0, 0, 0, 0.3);
                border: 1px solid rgba(255, 255, 255, 0.05);
                border-radius: 12px;
                backdrop-filter: blur(10px);
                overflow: hidden;
                transition: max-height 0.3s ease;
                margin-top: 15px;
                cursor: default;
                -webkit-user-select: none;
                user-select: none;
                max-height: 500px; /* Default expanded height */
            }
            .impact-details-panel.collapsed {
                max-height: 44px;
            }
            .impact-details-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 12px 16px;
                cursor: pointer;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
                -webkit-user-select: none;
                user-select: none;
            }
            .impact-details-header:hover {
                background: rgba(143, 241, 182, 0.05);
            }
            .impact-details-panel.collapsed .impact-details-header {
                border-bottom: none;
            }
            .impact-details-title {
                display: flex;
                align-items: center;
                gap: 8px;
                color: #8ff1b6;
                font-weight: 600;
                font-size: 0.85rem;
            }
            .impact-details-toggle {
                color: #8ff1b6;
                transition: transform 0.3s ease;
            }
            .impact-details-panel.collapsed .impact-details-toggle {
                transform: rotate(180deg);
            }
            .impact-details-content {
                padding: 0 16px 16px;
            }
            .impact-details-table {
                width: 100%;
                border-collapse: collapse;
                font-size: 0.75rem;
            }
            .impact-details-table th {
                text-align: left;
                color: #94a3b8;
                font-weight: 500;
                padding: 6px 10px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            .impact-details-table td {
                padding: 6px 10px;
                color: #fff;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }
            .impact-details-table tr:last-child td {
                border-bottom: none;
            }
            .impact-details-table .model-name {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            .impact-details-table .model-color {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                flex-shrink: 0;
            }
            .impact-details-table .value-primary {
                font-weight: 600;
                color: #fff;
            }
            .impact-details-table .value-secondary {
                font-size: 0.7rem;
                color: #64748b;
            }

            .benchmark-section {
                background: #0d1420;
                border: var(--border);
                border-radius: 12px;
                padding: 20px;
                display: flex;
                flex-direction: column;
                min-height: 400px;
            }

            /* Fullscreen 3D button */
            .fullscreen-btn {
                position: absolute;
                top: 20px;
                right: 20px;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.3);
                color: #fff;
                padding: 10px 15px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 0.85rem;
                transition: all 0.2s;
                z-index: 10;
            }
            .fullscreen-btn:hover {
                background: #fff;
                color: #000;
            }

            .selected-models-panel {
                background: rgba(0, 0, 0, 0.3);
                border: 1px solid rgba(255, 255, 255, 0.05);
                border-radius: 12px;
                backdrop-filter: blur(10px);
                overflow: hidden;
                transition: all 0.3s ease;
                margin-bottom: 15px;
                cursor: default;
                -webkit-user-select: none;
                user-select: none;
            }
            .selected-models-panel.collapsed .selected-models-content {
                display: none;
            }
            .selected-models-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 10px 14px;
                cursor: pointer;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
                transition: background 0.2s;
            }
            .selected-models-header:hover {
                background: rgba(143, 241, 182, 0.05);
            }
            .selected-models-panel.collapsed .selected-models-header {
                border-bottom: none;
            }
            .selected-models-title {
                display: flex;
                align-items: center;
                gap: 8px;
                color: #8ff1b6;
                font-size: 0.85rem;
                font-weight: 600;
            }
            .selected-models-toggle {
                color: #8ff1b6;
                font-size: 0.75rem;
                transition: transform 0.3s;
            }
            .selected-models-panel.collapsed .selected-models-toggle {
                transform: rotate(180deg);
            }
            .selected-models-content {
                padding: 10px 14px;
                padding-top: 8px;
            }
            .lane-legend {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }
            .lane-badge {
                background: transparent;
                padding: 8px 14px;
                border-radius: 0;
                border: none;
                border-left: 3px solid;
                color: #fff;
                font-size: 0.8rem;
                font-weight: 600;
                backdrop-filter: none;
                display: flex;
                align-items: center;
                gap: 8px;
                min-width: auto;
            }
            .lane-badge .color-dot {
                width: 10px;
                height: 10px;
                border-radius: 50%;
                flex-shrink: 0;
            }

            .view-section {
                display: none;
                animation: fadeIn 0.4s ease;
            }
            .view-section.active {
                display: block;
            }
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.85);
                z-index: 100;
                display: none;
                align-items: center;
                justify-content: center;
            }
            .modal-overlay.open {
                display: flex;
                animation: fadeIn 0.3s;
            }
            .modal-card {
                background: #0d1828;
                border: 1px solid #1a2d40;
                width: 500px;
                max-width: 90vw;
                border-radius: 20px;
                padding: 30px;
                position: relative;
            }
            .modal-close {
                position: absolute;
                top: 15px;
                right: 15px;
                background: none;
                border: none;
                color: #aaa;
                cursor: pointer;
                font-size: 1.5rem;
                width: 36px;
                height: 36px;
                border-radius: 50%;
                transition: all 0.2s;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .modal-close:hover {
                background: rgba(255, 255, 255, 0.1);
                color: #fff;
            }

            /* Fullscreen 3D Modal */
            .fullscreen-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #000;
                z-index: 200;
                display: none;
            }
            .fullscreen-modal.open {
                display: block;
            }
            .fullscreen-modal #three-container-fullscreen {
                width: 100%;
                height: 100%;
                position: relative;
            }
            .fullscreen-modal #three-container-fullscreen canvas {
                width: 100% !important;
                height: 100% !important;
                display: block;
            }
            .fullscreen-close {
                position: absolute;
                top: 20px;
                right: 20px;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.3);
                color: #fff;
                padding: 10px 20px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 1rem;
                z-index: 210;
            }

            /* Chart Tabs */
            .chart-tabs {
                display: flex;
                gap: 10px;
                background: rgba(255, 255, 255, 0.05);
                padding: 4px;
                border-radius: 8px;
            }
            .chart-tab {
                background: transparent;
                color: #94a3b8;
                border: 1px solid transparent;
                padding: 10px 20px;
                border-radius: 20px;
                cursor: pointer;
                font-size: 0.85rem;
                font-weight: 600;
                transition: all 0.2s ease;
                flex: 1;
                text-align: center;
                white-space: nowrap;
            }
            .chart-tab:hover {
                background: rgba(255, 255, 255, 0.08);
                color: #fff;
            }
            .chart-tab.active {
                background: rgba(255, 255, 255, 0.95);
                color: #000;
                border-color: rgba(255, 255, 255, 0.2);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            }

            /* Responsive Design */
            @media (max-width: 1400px) {
                .layout {
                    grid-template-columns: 280px 1fr;
                }
                .sidebar {
                    padding: 20px;
                }
                .sidebar-toggle {
                    left: 280px;
                }
                .layout.sidebar-hidden .sidebar-toggle {
                    left: 0;
                }
            }
            @media (max-width: 1200px) {
                .cards-grid {
                    grid-template-columns: repeat(2, 1fr);
                }
                .environmental-cards {
                    grid-template-columns: 1fr;
                }
                .rating-section {
                    flex-direction: column;
                    gap: 25px;
                }
                .rating-ladder {
                    width: 100%;
                }
                .bench-layout {
                    grid-template-columns: 1fr;
                    grid-template-rows: 1fr 1fr;
                }
                .quick-summary {
                    grid-template-columns: repeat(2, 1fr) !important;
                }
            }
            @media (max-width: 1000px) {
                .layout {
                    grid-template-columns: 260px 1fr;
                }
                .sidebar {
                    padding: 15px;
                }
                .sidebar-toggle {
                    left: 260px;
                }
                .layout.sidebar-hidden .sidebar-toggle {
                    left: 0;
                }
                .content {
                    padding: 25px;
                }
                .section-title {
                    font-size: 1.2rem;
                }
                .section-desc {
                    font-size: 0.85rem;
                }
                .impact-card {
                    padding: 20px;
                }
                .human-stat {
                    font-size: 1.8rem;
                }
            }
            @media (max-width: 900px) {
                .layout {
                    grid-template-columns: 1fr;
                }
                .sidebar {
                    display: none;
                    position: fixed;
                    left: 0;
                    top: 60px;
                    width: 300px;
                    height: calc(100% - 60px);
                    z-index: 50;
                    transform: translateX(-100%);
                    transition: transform 0.3s ease;
                }
                .sidebar.open {
                    transform: translateX(0);
                    display: flex;
                }
                .sidebar-toggle {
                    display: none;
                }
                .mobile-menu-btn {
                    display: flex !important;
                }
                .content {
                    padding: 20px;
                }
            }
            @media (max-width: 600px) {
                .cards-grid {
                    grid-template-columns: 1fr;
                }
                .quick-summary {
                    grid-template-columns: 1fr !important;
                    gap: 10px;
                }
                .score-grade {
                    font-size: 2.5rem;
                }
                header {
                    padding: 0 15px;
                }
                .nav-tabs {
                    gap: 10px;
                }
                .nav-btn {
                    padding: 0 10px;
                    font-size: 0.85rem;
                }
                .chart-box {
                    padding: 15px;
                    height: 250px;
                }
                .section-title {
                    font-size: 1rem;
                }
                .section-desc {
                    font-size: 0.8rem;
                    white-space: normal !important;
                }
            }

            /* Mobile menu button (hidden by default) */
            .mobile-menu-btn {
                display: none;
                background: none;
                border: none;
                color: #fff;
                font-size: 1.5rem;
                cursor: pointer;
                padding: 8px;
            }

            /* Help tooltip / onboarding indicator - GREEN */
            .help-indicator {
                position: relative;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                width: 18px;
                height: 18px;
                background: rgba(59, 130, 246, 0.2);
                color: var(--primary);
                border-radius: 50%;
                font-size: 0.7rem;
                font-weight: 700;
                cursor: help;
                margin-left: 8px;
            }
            .help-indicator:hover::after {
                content: attr(data-help);
                position: absolute;
                bottom: 100%;
                left: 50%;
                transform: translateX(-50%);
                background: #0d1828;
                color: #fff;
                padding: 8px 12px;
                border-radius: 6px;
                font-size: 0.75rem;
                white-space: nowrap;
                z-index: 100;
                border: 1px solid rgba(255, 255, 255, 0.1);
                margin-bottom: 5px;
                font-weight: 400;
            }

            /* Info box in token calculator modal - GREEN */
            .info-highlight {
                background: rgba(59, 130, 246, 0.1);
                padding: 15px;
                border-radius: 8px;
                border-left: 3px solid var(--primary);
            }

            /* Keyboard shortcut hints */
            .kbd {
                display: inline-block;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 4px;
                padding: 2px 6px;
                font-size: 0.7rem;
                font-family: var(--font-mono);
                color: #94a3b8;
            }

            /* PROGRESSIVE DISCLOSURE: Step indicator and wizard styles */
            .step-indicator {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 20px;
                margin-bottom: 30px;
                padding: 15px;
                background: rgba(0, 0, 0, 0.2);
                border-radius: 12px;
            }
            .step {
                display: flex;
                align-items: center;
                gap: 10px;
                opacity: 0.4;
                transition: all 0.3s ease;
            }
            .step.active {
                opacity: 1;
            }
            .step.completed {
                opacity: 0.7;
            }
            .step-number {
                width: 32px;
                height: 32px;
                background: rgba(255, 255, 255, 0.1);
                border: 2px solid rgba(255, 255, 255, 0.2);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 700;
                font-size: 0.9rem;
                transition: all 0.3s ease;
            }
            .step.active .step-number {
                background: var(--primary);
                border-color: var(--primary);
                color: #000;
            }
            .step.completed .step-number {
                background: var(--eu-a);
                border-color: var(--eu-a);
                color: #fff;
            }
            .step-text {
                font-size: 0.85rem;
                font-weight: 600;
            }
            .step-connector {
                width: 40px;
                height: 2px;
                background: rgba(255, 255, 255, 0.2);
            }
            .step-connector.active {
                background: var(--primary);
            }

            /* Results section initially hidden */
            .results-section {
                opacity: 0;
                transform: translateY(20px);
                transition: all 0.5s ease;
                pointer-events: none;
            }
            .results-section.visible {
                opacity: 1;
                transform: translateY(0);
                pointer-events: all;
            }

            /* Calculate button */
            .calculate-btn {
                width: 100%;
                padding: 15px 30px;
                background: linear-gradient(135deg, var(--primary), var(--primary-dark));
                border: none;
                border-radius: 12px;
                color: #000;
                font-size: 1rem;
                font-weight: 700;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                margin-top: 20px;
            }
            .calculate-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
            }
            .calculate-btn:active {
                transform: translateY(0);
            }
            .calculate-btn i {
                font-size: 1.1rem;
            }

            /* Tutorial Overlay - Step-by-step guide */
            .tutorial-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                z-index: 200;
                display: none;
                pointer-events: none;
            }
            .tutorial-overlay.active {
                display: block;
                pointer-events: all;
            }

            .tutorial-spotlight {
                position: absolute;
                border: 2px solid rgba(143, 241, 182, 0.6);
                border-radius: 12px;
                box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
                pointer-events: none;
                transition: all 0.4s ease;
                z-index: 201;
                background: rgba(255, 255, 255, 0.01);
            }

            .tutorial-tooltip {
                position: absolute;
                background: linear-gradient(135deg, #0d1828, #070912);
                border: 2px solid var(--primary);
                border-radius: 16px;
                padding: 25px;
                max-width: 350px;
                z-index: 202;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            }

            .tutorial-step-number {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                width: 32px;
                height: 32px;
                background: var(--primary);
                color: #000;
                border-radius: 50%;
                font-weight: 800;
                font-size: 0.9rem;
                margin-bottom: 12px;
            }

            .tutorial-title {
                font-size: 1.2rem;
                font-weight: 700;
                color: #fff;
                margin-bottom: 10px;
            }

            .tutorial-desc {
                color: #94a3b8;
                font-size: 0.9rem;
                line-height: 1.6;
                margin-bottom: 20px;
            }

            .tutorial-actions {
                display: flex;
                gap: 10px;
                justify-content: flex-end;
            }

            .tutorial-btn {
                padding: 10px 20px;
                border-radius: 8px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                border: 1px solid transparent;
                font-size: 0.9rem;
            }

            .tutorial-btn-skip {
                background: rgba(255, 255, 255, 0.1);
                color: #94a3b8;
                border-color: rgba(255, 255, 255, 0.1);
            }

            .tutorial-btn-skip:hover {
                background: rgba(255, 255, 255, 0.15);
                color: #fff;
                border-color: rgba(255, 255, 255, 0.3);
                transform: translateY(-2px);
            }

            .tutorial-btn-next {
                background: #8ff1b6;
                color: #0f172a;
                border-color: #8ff1b6;
            }

            .tutorial-btn-next:hover {
                background: #a5f3c3;
                transform: translateY(-2px);
                box-shadow: 0 4px 15px rgba(143, 241, 182, 0.4);
                border-color: #a5f3c3;
            }

            .tutorial-progress {
                display: flex;
                gap: 8px;
                justify-content: center;
                margin-top: 15px;
            }

            .tutorial-progress-dot {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.2);
                transition: all 0.3s;
                cursor: pointer;
            }
            .tutorial-progress-dot:hover {
                background: rgba(143, 241, 182, 0.5);
            }

            .tutorial-progress-dot.active {
                background: #8ff1b6;
                width: 24px;
                border-radius: 4px;
            }

            /* Onboarding Modal - First time visitor intro */
            .onboarding-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                z-index: 150;
                display: none;
                align-items: center;
                justify-content: center;
            }
            .onboarding-modal.open {
                display: flex;
                animation: fadeIn 0.5s;
            }
            .onboarding-card {
                background: linear-gradient(135deg, #0d1828, #070912);
                border: 1px solid rgba(59, 130, 246, 0.3);
                width: 550px;
                max-width: 90vw;
                border-radius: 24px;
                padding: 40px;
                text-align: center;
                position: relative;
            }
            .onboarding-icon {
                width: 80px;
                height: 80px;
                background: linear-gradient(135deg, var(--primary), var(--primary-dark));
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 25px;
                font-size: 2.5rem;
                color: #fff;
            }
            .onboarding-title {
                font-size: 1.8rem;
                font-weight: 800;
                color: #fff;
                margin-bottom: 15px;
            }
            .onboarding-subtitle {
                font-size: 1rem;
                color: var(--primary);
                font-weight: 600;
                margin-bottom: 20px;
            }
            .onboarding-desc {
                font-size: 0.95rem;
                color: #94a3b8;
                line-height: 1.7;
                margin-bottom: 30px;
            }
            .onboarding-features {
                display: flex;
                gap: 15px;
                margin-bottom: 30px;
                flex-wrap: wrap;
                justify-content: center;
            }
            .onboarding-feature {
                background: rgba(255, 255, 255, 0.05);
                padding: 12px 18px;
                border-radius: 10px;
                display: flex;
                align-items: center;
                gap: 10px;
                font-size: 0.85rem;
                color: #fff;
            }
            .onboarding-feature i {
                color: var(--primary);
            }
            .onboarding-btn {
                background: linear-gradient(135deg, var(--primary), var(--primary-dark));
                border: none;
                padding: 15px 40px;
                border-radius: 50px;
                color: #000;
                font-size: 1rem;
                font-weight: 700;
                cursor: pointer;
                transition: all 0.3s;
            }
            .onboarding-btn:hover {
                transform: scale(1.05);
                box-shadow: 0 8px 30px rgba(59, 130, 246, 0.4);
            }
            .onboarding-skip {
                margin-top: 15px;
                font-size: 0.8rem;
                color: #64748b;
                cursor: pointer;
                transition: color 0.2s;
            }
            .onboarding-skip:hover {
                color: #94a3b8;
            }

            /* Language Switcher */
            .lang-switcher {
                position: relative;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            .lang-btn {
                background: rgba(255, 255, 255, 0.05);
                border: 1px solid rgba(255, 255, 255, 0.15);
                color: #94a3b8;
                padding: 6px 12px;
                border-radius: 6px;
                font-size: 0.8rem;
                cursor: pointer;
                transition: all 0.2s;
                display: flex;
                align-items: center;
                gap: 6px;
            }
            .lang-btn:hover {
                background: rgba(59, 130, 246, 0.1);
                border-color: var(--primary);
                color: #fff;
            }
            .lang-dropdown {
                position: absolute;
                top: 100%;
                right: 0;
                background: #0d1828;
                border: 1px solid rgba(255, 255, 255, 0.15);
                border-radius: 8px;
                padding: 8px 0;
                min-width: 140px;
                z-index: 100;
                display: none;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            }
            .lang-dropdown.open {
                display: block;
                animation: fadeIn 0.2s;
            }
            .lang-option {
                padding: 10px 16px;
                cursor: pointer;
                font-size: 0.85rem;
                color: #94a3b8;
                transition: all 0.2s;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .lang-option:hover {
                background: rgba(59, 130, 246, 0.1);
                color: #fff;
            }
            .lang-option.active {
                color: var(--primary);
                font-weight: 600;
            }
            .lang-option .flag {
                font-size: 1.1rem;
            }

            /* Data Sources Footer */
            .data-sources {
                margin-top: 40px;
                padding: 25px;
                background: rgba(0, 0, 0, 0.3);
                border-radius: 12px;
                border: 1px solid rgba(255, 255, 255, 0.05);
            }
            .data-sources-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                cursor: pointer;
                color: #94a3b8;
                font-size: 0.85rem;
                font-weight: 600;
            }
            .data-sources-header:hover {
                color: #fff;
            }
            .data-sources-header i {
                transition: transform 0.3s;
            }
            .data-sources.open .data-sources-header i {
                transform: rotate(180deg);
            }
            .data-sources-content {
                display: none;
                margin-top: 20px;
                padding-top: 20px;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
            }
            .data-sources.open .data-sources-content {
                display: block;
                animation: fadeIn 0.3s;
            }
            .source-item {
                display: flex;
                align-items: flex-start;
                gap: 12px;
                margin-bottom: 15px;
                padding: 12px;
                background: rgba(255, 255, 255, 0.02);
                border-radius: 8px;
            }
            .source-item i {
                color: var(--primary);
                margin-top: 3px;
            }
            .source-item a {
                color: var(--primary);
                text-decoration: none;
            }
            .source-item a:hover {
                text-decoration: underline;
            }
            .source-title {
                font-weight: 600;
                color: #fff;
                font-size: 0.9rem;
                margin-bottom: 4px;
            }
            .source-desc {
                color: #64748b;
                font-size: 0.8rem;
                line-height: 1.5;
            }

            /* View Mode Toggle (Simple/Advanced) */
            .view-toggle {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 8px 16px;
                background: rgba(0, 0, 0, 0.3);
                border-radius: 8px;
                margin-bottom: 20px;
            }
            .view-toggle-label {
                font-size: 0.8rem;
                color: #94a3b8;
            }
            .toggle-switch {
                position: relative;
                width: 50px;
                height: 26px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 13px;
                border: 1px solid #8ff1b6;
                cursor: pointer;
                transition: background 0.3s;
            }
            .toggle-switch.active {
                background: linear-gradient(135deg, var(--primary) 0%, #60fa9e 100%);
            }
            .toggle-switch::after {
                content: "";
                position: absolute;
                top: 3px;
                left: 3px;
                width: 20px;
                height: 20px;
                background: #fff;
                border-radius: 50%;
                transition: transform 0.3s;
            }
            .toggle-switch.active::after {
                transform: translateX(24px);
            }
            .view-mode-text {
                font-size: 0.85rem;
                font-weight: 600;
                color: #fff;
                min-width: 70px;
            }

            /* Advanced data display */
            .advanced-data {
                display: none;
                margin-top: 10px;
                padding: 12px;
                background: rgba(0, 0, 0, 0.3);
                border-radius: 8px;
                font-family: var(--font-mono);
                font-size: 0.8rem;
            }
            .advanced-data.visible {
                display: block;
                animation: fadeIn 0.3s;
            }

            /* Hide sections in Simple mode */
            .simple-mode-hidden {
                display: none !important;
            }
            .simple-mode-hidden.visible {
                display: block !important;
                animation: fadeIn 0.3s;
            }
            .advanced-row {
                display: flex;
                justify-content: space-between;
                padding: 6px 0;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }
            .advanced-row:last-child {
                border-bottom: none;
            }
            .advanced-label {
                color: #64748b;
            }
            .advanced-value {
                color: var(--primary);
                font-weight: 600;
            }

            /* Section headers for clarity */
            .section-header {
                margin-bottom: 25px;
            }
            .section-title {
                font-size: 1.4rem;
                font-weight: 800;
                color: #fff;
                margin-bottom: 8px;
                display: flex;
                align-items: center;
                gap: 12px;
            }
            .section-title i {
                color: var(--primary);
                font-size: 1.1rem;
            }
            .section-desc {
                font-size: 0.9rem;
                color: #94a3b8;
                line-height: 1.5;
                max-width: 600px;
            }

            /* Quick stats summary */
            .quick-summary {
                display: flex;
                gap: 30px;
                padding: 15px 20px;
                background: rgba(0, 0, 0, 0.3);
                border-radius: 10px;
                margin-bottom: 25px;
                flex-wrap: wrap;
            }
            .quick-stat {
                text-align: center;
                cursor: default;
                -webkit-user-select: none;
                user-select: none;
            }
            .quick-stat-value {
                font-size: 1.5rem;
                font-weight: 800;
                color: #fff;
            }
            .quick-stat-label {
                font-size: 0.7rem;
                color: #64748b;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            /* Comparison indicator */
            .comparison-badge {
                display: inline-flex;
                align-items: center;
                gap: 5px;
                padding: 4px 10px;
                border-radius: 20px;
                font-size: 0.75rem;
                font-weight: 600;
            }
            .comparison-badge.good {
                background: rgba(0, 150, 64, 0.2);
                color: #4ade80;
            }
            .comparison-badge.warning {
                background: rgba(251, 186, 0, 0.2);
                color: #fbbf24;
            }
            .comparison-badge.bad {
                background: rgba(227, 6, 19, 0.2);
                color: #f87171;
            }

            /* Icon tooltips for impact cards */
            .icon-with-label {
                position: relative;
                cursor: help;
            }
            .icon-with-label::after {
                content: attr(data-label);
                position: absolute;
                top: 100%;
                right: 0;
                transform: translateY(8px);
                background: rgba(0, 0, 0, 0.9);
                color: #fff;
                padding: 6px 12px;
                border-radius: 6px;
                font-size: 0.75rem;
                font-weight: 500;
                white-space: nowrap;
                opacity: 0;
                pointer-events: none;
                transition:
                    opacity 0.2s,
                    transform 0.2s;
                z-index: 100;
                border: 1px solid rgba(255, 255, 255, 0.1);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            }
            .icon-with-label:hover::after {
                opacity: 1;
                transform: translateY(4px);
            }
        </style>
    </head>
    <body>
        <!-- Skip link for accessibility -->
        <a href="#main-content" class="skip-link">Skip to main content</a>

        <!-- Toast container for notifications -->
        <div class="toast-container" id="toastContainer" aria-live="polite"></div>

        <!-- Onboarding Modal - explains platform purpose -->
        <div
            class="onboarding-modal"
            id="onboardingModal"
            role="dialog"
            aria-modal="true"
            aria-labelledby="onboardingTitle">
            <div class="onboarding-card" style="border-color: #8ff1b6">
                <div
                    class="onboarding-icon"
                    style="background: linear-gradient(135deg, var(--primary) 0%, #60fa9e 100%)">
                    <i class="fas fa-seedling"></i>
                </div>
                <h2 class="onboarding-title" id="onboardingTitle" style="color: #8ff1b6">Welcome to AI Eco</h2>
                <div class="onboarding-subtitle" style="color: #c9eed8">
                    A Tool for Raising Environmental Awareness of GenAI Use
                </div>
                <p class="onboarding-desc">
                    This platform helps you understand the <strong>environmental footprint</strong> of different
                    generative AI models. It's <em>not</em> a performance simulation toolit's designed to raise
                    awareness about the energy, water, and e-waste impact of everyday AI usage.
                </p>
                <div class="onboarding-features">
                    <div class="onboarding-feature">
                        <i class="fas fa-lightbulb" style="color: #8ff1b6"></i>
                        <span>Energy Usage</span>
                    </div>
                    <div class="onboarding-feature">
                        <i class="fas fa-tint" style="color: #8ff1b6"></i>
                        <span>Water Consumption</span>
                    </div>
                    <div class="onboarding-feature">
                        <i class="fas fa-microchip" style="color: #8ff1b6"></i>
                        <span>E-Waste Impact</span>
                    </div>
                </div>
                <button
                    class="onboarding-btn"
                    onclick="startTutorial()"
                    style="background: linear-gradient(135deg, var(--primary) 0%, #60fa9e 100%)">
                    <i class="fas fa-graduation-cap" style="margin-right: 8px"></i>Start Tutorial
                </button>
                <div class="onboarding-skip" onclick="closeOnboarding(true)" style="color: #c9eed8">Skip Tutorial</div>
            </div>
        </div>

        <!-- Tutorial Overlay -->
        <div class="tutorial-overlay" id="tutorialOverlay">
            <div class="tutorial-spotlight" id="tutorialSpotlight"></div>
            <div class="tutorial-tooltip" id="tutorialTooltip" style="border-color: #8ff1b6">
                <div
                    class="tutorial-step-number"
                    id="tutorialStepNumber"
                    style="background: linear-gradient(135deg, var(--primary) 0%, #60fa9e 100%)">
                    1
                </div>
                <div class="tutorial-title" id="tutorialTitle">Welcome!</div>
                <div class="tutorial-desc" id="tutorialDesc">Let's learn how to use this tool.</div>
                <div class="tutorial-actions">
                    <button class="tutorial-btn tutorial-btn-skip" onclick="skipTutorial()" style="border-color: rgb(255, 255, 255, 0.05);">Skip</button>
                    <button
                        class="tutorial-btn tutorial-btn-next"
                        onclick="nextTutorialStep()"
                        style="background: linear-gradient(135deg, var(--primary) 0%, #60fa9e 100%); border-style: none; ">
                        <span id="tutorialBtnText">Next</span>
                        <i class="fas fa-arrow-right" style="margin-left: 8px"></i>
                    </button>
                </div>
                <div class="tutorial-progress" id="tutorialProgress"></div>
            </div>
        </div>

        <div id="landing-layer" role="dialog" aria-label="Welcome screen">
            <!-- Animated background elements -->
            <div class="landing-orb"></div>
            <div class="landing-orb"></div>
            <div class="landing-orb"></div>
            <div class="scan-line"></div>
            <canvas id="landing-particles"></canvas>

            <!-- Left content panel -->
            <div
                style="
                    position: relative;
                    z-index: 100;
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    width: 100%;
                    max-width: 1400px;
                    height: 100%;
                    align-items: center;
                    padding: 0 60px;
                    gap: 80px;
                ">
                <!-- Left Side - Text Content -->
                <div style="text-align: left; position: relative; z-index: 100;">
                    <h1
                        style="
                            font-size: 4rem;
                            font-weight: 900;
                            color: ;
                            letter-spacing: -2px;
                            margin-bottom: 20px;
                            line-height: 1.1;
                        ">
                        AI<br />
                        <span
                            style="
                                background: linear-gradient(135deg, var(--primary) 0%, #60fa9e 100%);
                                -webkit-background-clip: text;
                                -webkit-text-fill-color: transparent;
                                background-clip: text;
                            "
                            >ECO</span
                        >
                    </h1>
                    <div
                        style="
                            font-size: 1rem;
                            color: #59dc8e;
                            font-size: 11px;
                            font-weight: 500;
                            letter-spacing: 2px;
                            margin-bottom: 15px;
                            text-transform: uppercase;
                        ">
                        Calculate, Compare & Visualize
                    </div>
                    <p
                        style="
                            color: #94a3b8;
                            font-size: 1.05rem;
                            line-height: 1.7;
                            margin-bottom: 40px;
                            max-width: 440px;
                        ">
                        Explore the environmental impact of the latest generative AI models using interactive
                        visualization and compare their impact to daily activities.
                    </p>

                    <button
                        id="exploreBtn"
                        style="background: linear-gradient(135deg, var(--primary) 0%, #4fe28a 100%); position: relative; z-index: 9999;"
                        class="start-btn"
                        onclick="enterApp()"
                        aria-label="Start the audit application">
                        <i class="fas fa-rocket" style="margin-right: 12px"></i>EXPLORE NOW
                    </button>

                    <div style="margin-top: 25px; color: #64748b; font-size: 0.8rem">
                        Press <span class="kbd">Enter</span> to begin your journey
                    </div>
                </div>

                <!-- Right Side - 3D Brain Visualization -->
                <div
                    style="
                        position: relative;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        height: 600px;
                        overflow: visible;
                        pointer-events: none;
                    ">
                    <canvas id="brain3d" style="width: 100%; height: 100%; pointer-events: none;"></canvas>

                    <!-- Floating info icons - decorative, not buttons -->
                    <div
                        class="floating-card"
                        style="position: absolute; top: 10%; left: -20px; animation-delay: 0s; pointer-events: none;">
                        <div class="icon-circle" style="background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);">
                            <i class="fas fa-bolt" style="color: #fff; font-size: 1.5rem;"></i>
                        </div>
                        <span class="icon-label">Energy</span>
                    </div>
                    <div
                        class="floating-card"
                        style="position: absolute; bottom: 10%; left: -10px; animation-delay: 1s; pointer-events: none;">
                        <div class="icon-circle" style="background: linear-gradient(135deg, #38bdf8 0%, #0284c7 100%);">
                            <i class="fas fa-tint" style="color: #fff; font-size: 1.5rem;"></i>
                        </div>
                        <span class="icon-label">Water</span>
                    </div>
                    <div
                        class="floating-card"
                        style="position: absolute; bottom: 10%; right: -20px; animation-delay: 2s; pointer-events: none;">
                        <div class="icon-circle" style="background: linear-gradient(135deg, #f472b6 0%, #db2777 100%);">
                            <i class="fas fa-microchip" style="color: #fff; font-size: 1.5rem;"></i>
                        </div>
                        <span class="icon-label">e-Waste</span>
                    </div>
                </div>
            </div>
        </div>

        <div
            class="modal-overlay"
            id="detailModal"
            onclick="closeModal()"
            role="dialog"
            aria-modal="true"
            aria-labelledby="mName">
            <div class="modal-card" onclick="event.stopPropagation()">
                <button class="modal-close" onclick="closeModal()" aria-label="Close modal">&times;</button>
                <h2 id="mName" style="color: #fff; margin-bottom: 5px">Model</h2>
                <p id="mDesc" style="color: #ccc; margin: 15px 0">Desc</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; text-align: center">
                    <div style="background: #000; padding: 15px 10px; border-radius: 8px">
                        <i class="fas fa-bolt" style="color: #fbbf24; margin-bottom: 5px"></i>
                        <b id="mEnergy" style="color: #fff; display: block; font-size: 1.2rem">0</b>
                        <span style="font-size: 0.7rem; color: #888">Wh / prompt</span>
                    </div>
                    <div style="background: #000; padding: 15px 10px; border-radius: 8px">
                        <i class="fas fa-tint" style="color: #38bdf8; margin-bottom: 5px"></i>
                        <b id="mWater" style="color: #fff; display: block; font-size: 1.2rem">0</b>
                        <span style="font-size: 0.7rem; color: #888">mL / prompt</span>
                    </div>
                    <div style="background: #000; padding: 15px 10px; border-radius: 8px">
                        <i class="fas fa-microchip" style="color: #f472b6; margin-bottom: 5px"></i>
                        <b id="mWaste" style="color: #fff; display: block; font-size: 1.2rem">0</b>
                        <span style="font-size: 0.7rem; color: #888">mg / prompt</span>
                    </div>
                </div>
                <!-- Model resources link -->
                <div id="mResources" style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); text-align: center;">
                    <a id="mLink" href="#" target="_blank" rel="noopener" style="color: #8ff1b6; font-size: 0.85rem; text-decoration: none; display: inline-flex; align-items: center; gap: 6px;">
                        <i class="fas fa-external-link-alt"></i>
                        <span style="color: #8ff1b6">Learn more about this model</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Token Calculator Modal (moved to separate page/modal) -->
        <div class="modal-overlay" id="tokenModal" onclick="closeTokenModal()" role="dialog" aria-modal="true">
            <div class="modal-card" onclick="event.stopPropagation()" style="max-width: 600px">
                <button class="modal-close" onclick="closeTokenModal()" aria-label="Close modal">&times;</button>
                <h2 style="color: #fff; margin-bottom: 15px">
                    <i class="fas fa-calculator" style="color: var(--primary); margin-right: 10px"></i>Token Calculator
                </h2>
                <p style="color: #94a3b8; margin-bottom: 20px">
                    Convert between prompts and tokens to understand the technical details.
                </p>

                <div style="background: rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 12px; margin-bottom: 20px">
                    <div style="margin-bottom: 15px">
                        <label style="color: #fff; font-size: 0.85rem; display: block; margin-bottom: 8px"
                            >Number of Prompts</label
                        >
                        <input
                            type="number"
                            id="tokenCalcPrompts"
                            value="100"
                            min="1"
                            style="
                                width: 100%;
                                padding: 12px;
                                background: #0a1220;
                                border: 1px solid rgba(59, 130, 246, 0.2);
                                border-radius: 8px;
                                color: #fff;
                                font-size: 1rem;
                            "
                            oninput="calculateTokens()" />
                    </div>
                    <div style="text-align: center; color: #64748b; margin: 15px 0">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <div>
                        <label style="color: #fff; font-size: 0.85rem; display: block; margin-bottom: 8px"
                            >Equivalent Tokens</label
                        >
                        <div
                            style="
                                padding: 12px;
                                background: #070912;
                                border-radius: 8px;
                                color: var(--primary);
                                font-size: 1.5rem;
                                font-weight: 700;
                                font-family: var(--font-mono);
                            "
                            id="tokenCalcResult">
                            100,000
                        </div>
                    </div>
                </div>

                <div
                    style="
                        background: rgba(59, 130, 246, 0.1);
                        padding: 15px;
                        border-radius: 8px;
                        border-left: 3px solid var(--primary);
                    ">
                    <div style="font-size: 0.75rem; color: var(--primary); font-weight: 700; margin-bottom: 6px">
                        ABOUT TOKENS
                    </div>
                    <div style="font-size: 0.85rem; color: #94a3b8; line-height: 1.5">
                        A token is roughly <strong style="color: #fff">4 characters</strong> or
                        <strong style="color: #fff">0.75 words</strong>. A typical AI prompt uses about
                        <strong style="color: #fff">1,000 tokens</strong> (including response).
                    </div>
                </div>
            </div>
        </div>

        <div id="app-container">
            <header
                role="banner"
                style="background: linear-gradient(135deg, rgba(4, 15, 41, 0.45), rgba(1, 25, 11, 0.68))">
                <div style="display: flex; align-items: center; gap: 15px">
                    <button class="mobile-menu-btn" onclick="toggleSidebar()" aria-label="Toggle menu">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div
                        class="brand"
                        style="color:; font-weight: 800; font-size: 1.1rem; cursor: pointer"
                        onclick="goToHome()"
                        title="Go to home">
                        <i class="fas fa-leaf" style="color: #8ff1b6; margin-right: 10px"></i> AI Eco
                    </div>
                </div>
                <nav class="nav-tabs" role="tablist" aria-label="Main navigation">
                    <button
                        class="nav-btn active"
                        onclick="switchTab('dashboard', this)"
                        aria-selected="true"
                        role="tab"
                        aria-controls="dashboard"
                        type="button">
                        <i class="fas fa-chart-pie" style="margin-right: 8px"></i> Environmental Impact
                    </button>
                    <button
                        class="nav-btn"
                        onclick="switchTab('benchmarks', this)"
                        aria-selected="false"
                        role="tab"
                        aria-controls="benchmarks"
                        type="button">
                        <i class="fas fa-cubes" style="margin-right: 8px"></i>3D Visualization
                    </button>
                </nav>
                <button
                    class="nav-btn"
                    type="button"
                    onclick="showHelp()"
                    style="border-bottom: 2px solid transparent;"
                    aria-label="Start Tutorial"
                    title="Watch tutorial">
                    <i class="fas fa-graduation-cap" style="margin-right: 8px"></i>Tutorial
                </button>
            </header>

            <div class="layout" id="mainLayout">
                <!-- Sidebar toggle button -->
                <button
                    type="button"
                    class="sidebar-toggle"
                    id="sidebarToggle"
                    onclick="toggleSidebarVisibility()"
                    aria-label="Toggle sidebar">
                    <i class="fas fa-chevron-left" style="color: #c9eed8"></i>
                </button>
                <aside
                    class="sidebar"
                    id="sidebar"
                    role="complementary"
                    aria-label="Controls"
                    style="background: linear-gradient(135deg, rgba(4, 15, 41), rgba(1, 25, 11))">
                    <!-- Help Info Box - Click to toggle -->

                    <div class="control-box" style="margin-bottom: 25px">
                        <div class="slider-label">
                            <span>
                                <i class="fas fa-comment-dots" style="color: #8ff1b6; margin-right: 6px"></i>DAILY
                                PROMPTS
                            </span>
                        </div>

                        <!-- CHANGED: Editable prompt input with edit button -->
                        <div class="prompt-display">
                            <div class="prompt-input-wrapper">
                                <input
                                    type="number"
                                    class="prompt-input"
                                    id="volInput"
                                    value="100"
                                    min="1"
                                    max="10000"
                                    oninput="syncSliderFromInput(this.value)"
                                    aria-label="Enter number of daily prompts" />
                            </div>
                            <div class="prompt-unit" style="color: #8ff1b6; cursor: default;">PROMPTS / DAY</div>
                            <div class="edit-hint">
                                <span style="padding-right: 5px; cursor: default;"> Click to edit</span>
                                <i class="fas fa-pencil-alt" style="color: #8ff1b6; cursor: pointer;" onclick="document.getElementById('volInput').focus()"></i>
                            </div>
                        </div>

                        <!-- Slider with integrated snap markers -->
                        <div class="slider-container">
                            <div class="slider-track-wrapper">
                                <input
                                    type="range"
                                    id="volSlider"
                                    min="1"
                                    max="10000"
                                    step="1"
                                    value="100"
                                    oninput="syncInputFromSlider(this.value)"
                                    aria-label="Daily prompt usage"
                                    aria-valuemin="1"
                                    aria-valuemax="10000"
                                    aria-valuenow="100" />
                                <div class="snap-markers" id="snapMarkers">
                                    <!-- Snap markers will be generated by JS -->
                                </div>
                            </div>
                        </div>
                        <div id="promptHelpBox">
                            <button
                                type="button"
                                onclick="togglePromptHelp()"
                                style="
                                    width: 111%;
                                    padding: 12px 10px;
                                    margin-left: -10px;
                                    background: rgba(59, 130, 246, 0.1);
                                    border: none;
                                    border-left: 3px solid #8ff1b6;
                                    border-radius: 8px;
                                    cursor: pointer;
                                    display: flex;
                                    align-items: center;
                                    gap: 10px;
                                    transition: background 0.2s;
                                ">
                                <i class="fas fa-info-circle" style="color: #8ff1b6; font-size: 1.1rem"></i>
                                <strong style="color: #ffffff; flex: 1; text-align: left; font-weight: 100"
                                    >What counts as a prompt?</strong
                                >
                                <i
                                    class="fas fa-chevron-down"
                                    id="promptHelpIcon"
                                    style="color: #8ff1b6; font-size: 0.8rem; transition: transform 0.2s"></i>
                            </button>
                            <div
                                id="promptHelpContent"
                                style="
                                    display: none;
                                    padding: 15px;
                                    background: rgba(59, 130, 246, 0.05);
                                    border-radius: 0 0 8px 8px;
                                    margin-top: -3px;
                                ">
                                <div style="color: #cbd5e1; font-size: 0.9rem; line-height: 1.6">
                                    One prompt = one question or request to an AI.
                                    <div style="margin-top: 6px; color: #94a3b8; font-size: 0.85rem">
                                        <i class="fas fa-lightbulb" style="margin-right: 5px; color: #fbbf24"></i
                                        >Example: <em>"Explain climate change"</em> is 1 prompt.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="slider-label" style="margin-bottom: 15px">
                            <span
                                ><i class="fas fa-robot" style="color: #8ff1b6; margin-right: 6px"></i>SELECT
                                MODELS</span
                            >
                        </div>
                        <div id="modelList" role="listbox" aria-label="Select AI models"></div>
                    </div>
                </aside>

                <main
                    class="content"
                    id="main-content"
                    style="background: linear-gradient(135deg, rgba(4, 15, 41, 0.45), rgb(1, 25, 11))">
                    <div id="dashboard" class="view-section active" role="tabpanel" aria-labelledby="dashboard-tab">
                        <!-- Section Header - SIMPLIFIED text -->
                        <div class="section-header">
                            <h2 class="section-title" style="cursor: default;">
                                <i class="fas fa-chart-line" style="color: #8ff1b6"></i> Your AI Impact
                            </h2>
                            <p class="section-desc" style="white-space: nowrap; cursor: default;">
                                See how your daily AI use affects the environment in simple everyday terms.
                            </p>
                        </div>

                        <!-- Results Section (initially hidden, shown after Calculate) -->
                        <div class="results-section" id="resultsSection">
                            <!-- View Mode Toggle -->
                            <div class="view-toggle">
                                <span class="view-toggle-label" style="cursor: default;"
                                    ><i class="fas fa-eye" style="margin-right: 6px; cursor: default; "></i>View:</span
                                >
                                <div class="toggle-switch" id="viewModeToggle" onclick="toggleViewMode()"></div>
                                <span class="view-mode-text" id="viewModeText" style="cursor: default;">Simple</span>
                            </div>

                            <!-- Quick Summary Bar - Three cards -->
                            <div
                                class="quick-summary"
                                style="
                                    display: grid;
                                    grid-template-columns: repeat(3, 1fr);
                                    gap: 12px;
                                    padding: 0;
                                    background: none;
                                ">
                                <div
                                    class="quick-stat"
                                    style="
                                        background: rgba(255, 255, 255, 0.05);
                                        padding: 12px;
                                        border-radius: 10px;
                                        border: 1px solid rgba(255, 255, 255, 0.05);
                                        text-align: center;
                                        display: flex;
                                        flex-direction: column;
                                        align-items: center;
                                        gap: 4px;
                                    ">
                                    <div style="width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-layer-group" style="color: #c9eed8; font-size: 0.85rem;"></i>
                                    </div>
                                    <div class="quick-stat-value" id="selectedCount" style="font-size: 1.4rem; color: #fff; font-weight: 700;">2</div>
                                    <div class="quick-stat-label" style="color: #94a3b8; font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.5px;">Models Selected</div>
                                </div>
                                <div
                                    class="quick-stat"
                                    style="
                                        background:rgba(255, 255, 255, 0.05);
                                        padding: 12px;
                                        border-radius: 10px;
                                        border: 1px solid rgba(255, 255, 255, 0.05);
                                        text-align: center;
                                        display: flex;
                                        flex-direction: column;
                                        align-items: center;
                                        gap: 4px;
                                    ">
                                    <div style="width: 32px; height: 32px; border-radius: 50%;  display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-comment-dots" style="color: #c9eed8; font-size: 0.85rem;"></i>
                                    </div>
                                    <div class="quick-stat-value" id="totalQueries" style="font-size: 1.4rem; color: #fff; font-weight: 700;">100</div>
                                    <div class="quick-stat-label" style="color: #94a3b8; font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.5px;">Prompts / Day</div>
                                </div>
                                <div
                                    class="quick-stat"
                                    style="
                                        background:rgba(255, 255, 255, 0.05);
                                        padding: 12px;
                                        border-radius: 10px;
                                        border: 1px solid rgba(255, 255, 255, 0.05);
                                        text-align: center;
                                        display: flex;
                                        flex-direction: column;
                                        align-items: center;
                                        gap: 4px;
                                    ">
                                    <div style="width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-bolt" style="color: #c9eed8; font-size: 0.85rem;"></i>
                                    </div>
                                    <div class="quick-stat-value" id="totalKwh" style="font-size: 1.4rem; color: #fff; font-weight: 700;">0</div>
                                    <div class="quick-stat-label" style="color: #94a3b8; font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.5px;">kWh / Year</div>
                                </div>
                            </div>

                            <!-- SIMPLIFIED: Score card - removed duplicate impact terminology -->
                            <div class="score-card" id="scoreCard" style="margin-bottom: 15px">
                                <div class="score-header">
                                    <i class="fas fa-leaf" style="margin-right: 8px"></i>OVERALL ENVIRONMENTAL IMPACT
                                </div>
                                <div class="score-grade" id="displayGrade">Low</div>
                                <div class="score-desc" id="displayTitle" style="font-size: 1rem; font-weight: 500">
                                    Good efficiency
                                </div>
                                <div class="score-context" id="displayContext">
                                    Your AI usage has minimal environmental impact.
                                </div>
                                <!-- Why does this matter section -->
                                <div style="margin-top: 12px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                                    <div style="display: flex; align-items: flex-start; gap: 8px;">
                                        <i class="fas fa-info-circle" style="color: #8ff1b6; margin-top: 2px; font-size: 0.8rem;"></i>
                                        <div>
                                            <div style="color: #8ff1b6; font-weight: 600; font-size: 0.75rem; margin-bottom: 4px;">Why does this matter?</div>
                                            <div style="color: #94a3b8; font-size: 0.7rem; line-height: 1.4;">
                                                AI models require significant computing power, which consumes electricity, water for cooling data centers, and contributes to hardware depreciation. More capable models typically use more resources per query.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Collapsible Impact Details Panel -->
                            <div class="impact-details-panel" id="impactDetailsPanel" style="border-color: rgb(255, 255, 255, 0.05); margin-top: 25px; margin-bottom: 25px;">
                                <div class="impact-details-header" onclick="toggleImpactDetails()">
                                    <div class="impact-details-title">
                                        <i class="fas fa-table" style="color: #c9eed8"></i>
                                        <span style="color: #c9eed8">Impact Details</span>
                                    </div>
                                    <i class="fas fa-chevron-up impact-details-toggle"></i>
                                </div>
                                <div class="impact-details-content">
                                    <table class="impact-details-table">
                                        <thead>
                                            <tr>
                                                <th>Model</th>
                                                <th><i class="fas fa-bolt" style="color: #fbbf24; margin-right: 4px;"></i>Energy</th>
                                                <th><i class="fas fa-tint" style="color: #38bdf8; margin-right: 4px;"></i>Water</th>
                                                <th><i class="fas fa-microchip" style="color: #f472b6; margin-right: 4px;"></i>E-Waste</th>
                                            </tr>
                                        </thead>
                                        <tbody id="impactDetailsBody">
                                            <!-- Populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- IMPROVED: Chart with daily comparisons and tabs -->
                            <div class="chart-box" style="margin-top: 25px; margin-bottom: 15px; background: rgba(255, 255, 255, 0.05); flex: 1; min-height: 0;">
                                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: nowrap; gap: 15px; margin-bottom: 15px;">
                                    <div style="flex: 1; min-width: 0;">
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <span style="font-size: 0.9rem; color: #fff; font-weight: 700; text-transform: uppercase;">
                                                Compare GenAI Models
                                            </span>
                                            <span style="background: rgba(143, 241, 182, 0.2); color: #8ff1b6; font-size: 0.65rem; padding: 2px 8px; border-radius: 10px; font-weight: 600;">
                                                <i class="fas fa-calendar-day" style="margin-right: 4px;"></i>PER DAY
                                            </span>
                                        </div>
                                        <span style="font-size: 0.7rem; color: #aaa; font-weight: 500; display: block; margin-top: 4px;">
                                            AI Use vs Daily Common Activities
                                        </span>
                                    </div>
                                    <!-- Chart Type Tabs - fixed position -->
                                    <div class="chart-tabs" style="display: flex; gap: 8px; background: rgba(255, 255, 255, 0.00); padding: 4px; border-radius: 8px; flex-shrink: 0;">
                                        <button
                                            class="chart-tab active"
                                            onclick="switchChart('energy')"
                                            data-chart="energy"
                                            style="border-color: #8ff1b6; font-weight: 600">
                                            <i class="fas fa-bolt" style="margin-right: 6px"></i>Energy
                                        </button>
                                        <button
                                            class="chart-tab"
                                            onclick="switchChart('water')"
                                            data-chart="water"
                                            style="border-color: #8ff1b6; font-weight: 600">
                                            <i class="fas fa-tint" style="margin-right: 6px"></i>Water
                                        </button>
                                        <button
                                            class="chart-tab"
                                            onclick="switchChart('waste')"
                                            data-chart="waste"
                                            style="border-color: #8ff1b6; font-weight: 600">
                                            <i class="fas fa-microchip" style="margin-right: 6px"></i>E-Waste
                                        </button>
                                    </div>
                                </div>
                                <div style="flex-grow: 1; position: relative">
                                    <canvas id="mainChart"></canvas>
                                </div>
                            </div>

                            <!-- Three environmental impact cards in a row - Hidden in Simple mode -->
                            <div class="simple-mode-hidden" style="margin-bottom: 30px;">
                                <div class="environmental-section-title" style="margin-bottom: 15px;">
                                    <i class="fas fa-globe-americas" style="color: #8ff1b6"></i>
                                    Environmental Impact Details
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                                    <!-- Energy Card -->
                                    <div class="impact-card" id="cardEnergy" style="margin: 0; border: 1px solid rgba(143, 241, 182, 0.3); background: rgba(255, 255, 255, 0.03); padding: 20px;">
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <div style="width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%); display: flex; align-items: center; justify-content: center;">
                                                    <i class="fas fa-bolt" style="color: #fff; font-size: 1.2rem;"></i>
                                                </div>
                                                <span style="color: #c9eed8; font-weight: 700; font-size: 0.85rem;">ENERGY</span>
                                            </div>
                                            <span class="severity-badge good" id="energySeverity" style="padding: 4px 8px; margin: 0; font-size: 0.65rem;">
                                                <i class="fas fa-check-circle"></i> Efficient
                                            </span>
                                        </div>
                                        <div class="human-stat" style="margin-bottom: 8px;">
                                            <span id="humanEnergy" style="font-size: 2rem;">0</span>
                                            <span class="stat-unit" style="font-size: 0.75rem;">Light Bulb/Hour</span>
                                        </div>
                                        <span style="color: #64748b; font-size: 0.7rem; display: block; margin-bottom: 15px;">
                                            Same as running a 60W bulb for this many hours each day
                                        </span>
                                        <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 12px; display: flex; flex-direction: column; gap: 6px;">
                                            <div style="display: flex; justify-content: space-between;">
                                                <span style="color: #94a3b8; font-size: 0.75rem;">Wh/day</span>
                                                <span id="advWhDay" style="color: #c9eed8; font-weight: 600; font-size: 0.75rem;">0 Wh</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between;">
                                                <span style="color: #94a3b8; font-size: 0.75rem;">kWh/year</span>
                                                <span id="advKwhYear" style="color: #c9eed8; font-weight: 600; font-size: 0.75rem;">0 kWh</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between;">
                                                <span style="color: #94a3b8; font-size: 0.75rem;">CO2/year</span>
                                                <span id="advCo2" style="color: #c9eed8; font-weight: 600; font-size: 0.75rem;">0 kg</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Water Card -->
                                    <div class="impact-card" id="cardWater" style="margin: 0; border: 1px solid rgba(143, 241, 182, 0.3); background: rgba(255, 255, 255, 0.03); padding: 20px;">
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <div style="width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(135deg, #38bdf8 0%, #0284c7 100%); display: flex; align-items: center; justify-content: center;">
                                                    <i class="fas fa-tint" style="color: #fff; font-size: 1.2rem;"></i>
                                                </div>
                                                <span style="color: #c9eed8; font-weight: 700; font-size: 0.85rem;">WATER</span>
                                            </div>
                                            <span class="severity-badge good" id="waterSeverity" style="padding: 4px 8px; margin: 0; font-size: 0.65rem;">
                                                <i class="fas fa-check-circle"></i> Efficient
                                            </span>
                                        </div>
                                        <div class="human-stat" style="margin-bottom: 8px;">
                                            <span id="humanWater" style="font-size: 2rem;">0</span>
                                            <span class="stat-unit" style="font-size: 0.75rem;">Bottles/Day</span>
                                        </div>
                                        <span style="color: #64748b; font-size: 0.7rem; display: block; margin-bottom: 15px;">
                                            Water used for cooling data centers (500mL bottle)
                                        </span>
                                        <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 12px; display: flex; flex-direction: column; gap: 6px;">
                                            <div style="display: flex; justify-content: space-between;">
                                                <span style="color: #94a3b8; font-size: 0.75rem;">mL/day</span>
                                                <span id="advMlDay" style="color: #c9eed8; font-weight: 600; font-size: 0.75rem;">0 mL</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between;">
                                                <span style="color: #94a3b8; font-size: 0.75rem;">Liters/year</span>
                                                <span id="advLitersYear" style="color: #c9eed8; font-weight: 600; font-size: 0.75rem;">0 L</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- E-Waste Card -->
                                    <div class="impact-card" id="cardWaste" style="margin: 0; border: 1px solid rgba(143, 241, 182, 0.3); background: rgba(255, 255, 255, 0.03); padding: 20px;">
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <div style="width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(135deg, #f472b6 0%, #db2777 100%); display: flex; align-items: center; justify-content: center;">
                                                    <i class="fas fa-microchip" style="color: #fff; font-size: 1.2rem;"></i>
                                                </div>
                                                <span style="color: #c9eed8; font-weight: 700; font-size: 0.85rem;">E-WASTE</span>
                                            </div>
                                            <span class="severity-badge good" id="wasteSeverity" style="padding: 4px 8px; margin: 0; font-size: 0.65rem;">
                                                <i class="fas fa-check-circle"></i> Efficient
                                            </span>
                                        </div>
                                        <div class="human-stat" style="margin-bottom: 8px;">
                                            <span id="humanWaste" style="font-size: 2rem;">0</span>
                                            <span class="stat-unit" style="font-size: 0.75rem;">Phones/Year</span>
                                        </div>
                                        <span style="color: #64748b; font-size: 0.7rem; display: block; margin-bottom: 15px;">
                                            Hardware waste from AI processing (200g phone metals)
                                        </span>
                                        <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 12px; display: flex; flex-direction: column; gap: 6px;">
                                            <div style="display: flex; justify-content: space-between;">
                                                <span style="color: #94a3b8; font-size: 0.75rem;">g/year</span>
                                                <span id="advGramsYear" style="color: #c9eed8; font-weight: 600; font-size: 0.75rem;">0 g</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between;">
                                                <span style="color: #94a3b8; font-size: 0.75rem;">kg/year</span>
                                                <span id="advKgYear" style="color: #c9eed8; font-weight: 600; font-size: 0.75rem;">0 kg</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <!-- Data Sources Section -->
                            <div class="data-sources" id="dataSources" onclick="toggleDataSources()" style="cursor: default;">
                                <div class="data-sources-header">
                                    <span
                                        ><i class="fas fa-database" style="margin-right: 8px"></i>Data Sources &
                                        Methodology</span
                                    >
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="data-sources-content" onclick="event.stopPropagation()">
                                    <div class="source-item">
                                        <i class="fas fa-file-alt" style="color:#8ff1b6"></i>
                                        <div>
                                            <div class="source-title">LLM Energy & Water Footprint (2025)</div>
                                            <div class="source-desc">
                                                Jehham et al. "How Hungry is AI? Benchmarking Energy, Water, and Carbon Footprint of LLM Inference" - GPT-4o uses ~0.42 Wh per query, o3/DeepSeek-R1 use 33+ Wh for complex prompts.
                                                <a
                                                    href="https://arxiv.org/abs/2505.09598"
                                                    target="_blank"
                                                    rel="noopener"
                                                   style="color:#8ff1b6"
                                                    >arXiv:2505.09598</a
                                                >
                                            </div>
                                        </div>
                                    </div>
                                    <div class="source-item">
                                        <i class="fas fa-file-alt" style="color:#8ff1b6"></i>
                                        <div>
                                            <div class="source-title">AI Water Footprint Research (2024)</div>
                                            <div class="source-desc">
                                                Li et al. "Making AI Less Thirsty: Uncovering and Addressing the Secret Water Footprint of AI Models" - ChatGPT uses 16.9-519 mL water per query depending on location.
                                                <a
                                                    href="https://arxiv.org/abs/2304.03271"
                                                    target="_blank"
                                                    rel="noopener"
                                                   style="color:#8ff1b6"
                                                    >arXiv:2304.03271</a
                                                >
                                            </div>
                                        </div>
                                    </div>
                                    <div class="source-item">
                                        <i class="fas fa-file-alt" style="color:#8ff1b6"></i>
                                        <div>
                                            <div class="source-title">Image Generation Energy (2024-2025)</div>
                                            <div class="source-desc">
                                                Luccioni et al. "Power Hungry Processing" - Image generation is most energy-intensive AI task. Also: "Energy Scaling Laws for Diffusion Models" - DALL-E/Midjourney class: 0.05-3.58 Wh/image.
                                                <a
                                                    href="https://arxiv.org/abs/2311.16863"
                                                    target="_blank"
                                                    rel="noopener"
                                                   style="color:#8ff1b6"
                                                    >arXiv:2311.16863</a
                                                > | <a
                                                    href="https://arxiv.org/abs/2511.17031"
                                                    target="_blank"
                                                    rel="noopener"
                                                       style="color:#8ff1b6"
                                                    >arXiv:2511.17031</a
                                                >
                                            </div>
                                        </div>
                                    </div>
                                    <div class="source-item">
                                        <i class="fas fa-calculator" style="color:#8ff1b6"></i>
                                        <div>
                                            <div class="source-title">Calculation Methodology</div>
                                            <div class="source-desc">
                                                Energy values based on 2024-2025 research. Water: ~20 mL per text query
                                                (global average PUE 1.2). E-waste calculated from GPU depreciation rates
                                                based on compute hours. Values are estimates and vary by data center
                                                location and efficiency.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- End of results-section -->
                    </div>

                    <!-- IMPROVED: 3D View with 50/50 split layout -->
                    <div id="benchmarks" class="view-section" role="tabpanel" aria-labelledby="benchmarks-tab">
                        <!-- Section Header - SIMPLIFIED -->
                        <div class="section-header">
                             <h2 class="section-title" style="cursor: default;">
                                <i class="fas fa-cubes" style="color: #8ff1b6"></i> Visual Comparison
                            </h2>
                            <p class="section-desc" style="cursor: default;">
                                See the difference between models at a glance. Each object represents a unit of impact.
                            </p>
                        </div>

                        <div class="bench-layout">
                            <!-- Selected Models Panel - Above 3D -->
                            <div class="selected-models-panel" id="selectedModelsPanel">
                                <div class="selected-models-header" onclick="toggleSelectedModels()">
                                    <div class="selected-models-title">
                                        <i class="fas fa-cube"></i>
                                        <span>Selected Models</span>
                                    </div>
                                    <i class="fas fa-chevron-up selected-models-toggle"></i>
                                </div>
                                <div class="selected-models-content">
                                    <div class="lane-legend" id="laneLegend" style="display: flex;"></div>
                                </div>
                            </div>

                            <div id="three-container">
                                <!-- Top right controls -->
                                <div
                                    style="
                                        position: absolute;
                                        top: 20px;
                                        right: 20px;
                                        display: flex;
                                        align-items: center;
                                        gap: 10px;
                                        z-index: 10;
                                    ">
                                    <div
                                        style="
                                            background: rgba(0, 0, 0, 0.6);
                                            padding: 6px 12px;
                                            border-radius: 20px;
                                            font-size: 0.75rem;
                                            color: #94a3b8;
                                            display: flex;
                                            align-items: center;
                                            gap: 6px;
                                        ">
                                        <i class="fas fa-sync-alt"></i> Drag to rotate
                                    </div>
                                    <button
                                        type="button"
                                        class="fullscreen-btn"
                                        onclick="openFullscreen3D()"
                                        style="position: static; border-color:   rgb(255, 255, 255, 0.1);">
                                        <i class="fas fa-expand"></i> Fullscreen
                                    </button>
                                </div>

                                <!-- Zoom controls -->
                                <div
                                    style="
                                        position: absolute;
                                        top: 20px;
                                        left: 20px;
                                        display: flex;
                                        flex-direction: column;
                                        gap: 8px;
                                        z-index: 10;

                                    ">
                                    <button
                                        type="button"
                                        class="t-btn"
                                        onclick="zoom3D(0.8)"
                                        title="Zoom In"
                                        style="padding: 0; display: flex; align-items: center; gap: 10px; font-weight: 300; background: transparent; border: none;">
                                        <span style="width: 36px; height: 36px; border-radius: 50%; border: 1px solid #8ff1b6; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.1);"><i class="fas fa-search-plus"></i></span>
                                        <span style="font-size: 0.75rem;">Zoom In</span>
                                    </button>
                                    <button
                                        type="button"
                                        class="t-btn"
                                        onclick="zoom3D(1.25)"
                                        title="Zoom Out"
                                        style="padding: 0; display: flex; align-items: center; gap: 10px; font-weight: 300; background: transparent; border: none;">
                                        <span style="width: 36px; height: 36px; border-radius: 50%; border: 1px solid #8ff1b6; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.1);"><i class="fas fa-search-minus"></i></span>
                                        <span style="font-size: 0.75rem;">Zoom Out</span>
                                    </button>
                                    <button
                                        type="button"
                                        class="t-btn"
                                        onclick="resetZoom()"
                                        title="Reset View"
                                        style="padding: 0; display: flex; align-items: center; gap: 10px; font-weight: 300; background: transparent; border: none;">
                                        <span style="width: 36px; height: 36px; border-radius: 50%; border: 1px solid #8ff1b6; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.1);"><i class="fas fa-undo"></i></span>
                                        <span style="font-size: 0.75rem;">Reset</span>
                                    </button>
                                </div>

                                <div class="three-controls">
                                    <button
                                        class="t-btn active"
                                        onclick="switch3DScene('energy', this)"
                                        title="Compare energy consumption"
                                        style="font-weight: 600">
                                        <i class="fas fa-lightbulb" style="margin-right: 6px"></i>Energy
                                    </button>
                                    <button
                                        class="t-btn"
                                        onclick="switch3DScene('water', this)"
                                        title="Compare water usage"
                                        style="border-color: #8ff1b6; font-weight: 600">
                                        <i class="fas fa-tint" style="margin-right: 6px"></i>Water
                                    </button>
                                    <button
                                        class="t-btn"
                                        onclick="switch3DScene('waste', this)"
                                        title="Compare e-waste"
                                        style="border-color: #8ff1b6; font-weight: 600">
                                        <i class="fas fa-mobile-alt" style="margin-right: 6px"></i>E-Waste
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- Fullscreen 3D Modal -->
        <div class="fullscreen-modal" id="fullscreen3D">
            <div
                style="
                    position: absolute;
                    top: 20px;
                    right: 20px;
                    display: flex;
                    flex-direction: column;
                    align-items: flex-end;
                    gap: 8px;
                    z-index: 10;
                ">
                <button type="button" class="fullscreen-close" onclick="closeFullscreen3D()" style="position: static; border-color:   rgb(255, 255, 255, 0.1);">
                    <i class="fas fa-times" style="margin-right: 8px; "></i>Close
                </button>
                <div
                    style="
                        background: rgba(0, 0, 0, 0.6);
                        margin-right: 130px;
                        margin-top: -40px;
                        padding: 6px 12px;
                        border-radius: 20px;
                        font-size: 0.75rem;
                        color: #94a3b8;
                        display: flex;
                        align-items: center;
                        gap: 6px;
                    ">
                    <i class="fas fa-sync-alt"></i> Drag to rotate
                </div>
            </div>
            <div id="three-container-fullscreen"></div>
        </div>

        <script>
            // --- CONFIG ---
            // IMPROVED: Higher contrast colors matching CSS variables
            // Extended model list with latest popular models
            // MODELS data based on 2024-2025 research:
            // ============================================
            // energy: Wh per prompt
            // water: mL per prompt
            // waste: mg per prompt
            // Sources: IEA 2024, Li et al. 2024 "Making AI Less Thirsty", arXiv papers
            // ============================================
            const MODELS = [
                {
                    id: "mistral",
                    name: "Mistral Large",
                    energy: 0.18,
                    water: 12,
                    waste: 0.8,
                    color: "#00D4FF",
                    desc: "Efficient European AI model"
                },
                {
                    id: "gpt35",
                    name: "GPT-3.5 Turbo",
                    energy: 0.3,
                    water: 20,
                    waste: 1.2,
                    color: "#74AA9C",
                    desc: "Fast, cost-effective (~0.3 Wh/query)"
                },
                {
                    id: "claude",
                    name: "Claude 3.5 Sonnet",
                    energy: 0.28,
                    water: 18,
                    waste: 1.1,
                    color: "#D97706",
                    desc: "Excellent efficiency-to-capability ratio"
                },
                {
                    id: "claude-opus",
                    name: "Claude 3 Opus",
                    energy: 0.55,
                    water: 35,
                    waste: 2.2,
                    color: "#B45309",
                    desc: "Most capable Claude model"
                },
                {
                    id: "gpt4",
                    name: "GPT-4o",
                    energy: 0.42,
                    water: 28,
                    waste: 1.7,
                    color: "#10B981",
                    desc: "Optimized GPT-4 (~0.3-0.5 Wh/query)"
                },
                {
                    id: "gpt4turbo",
                    name: "GPT-4.5",
                    energy: 0.65,
                    water: 42,
                    waste: 2.6,
                    color: "#059669",
                    desc: "Latest flagship model"
                },
                {
                    id: "gemini-pro",
                    name: "Gemini 1.5 Pro",
                    energy: 0.38,
                    water: 25,
                    waste: 1.5,
                    color: "#4285F4",
                    desc: "Google's multimodal AI"
                },
                {
                    id: "gemini-flash",
                    name: "Gemini 1.5 Flash",
                    energy: 0.15,
                    water: 10,
                    waste: 0.6,
                    color: "#1D4ED8",
                    desc: "Fastest, most efficient Gemini"
                },
                {
                    id: "llama3",
                    name: "Llama 3 70B",
                    energy: 0.32,
                    water: 21,
                    waste: 1.3,
                    color: "#0066FF",
                    desc: "Meta's open-source model"
                },
                {
                    id: "dalle",
                    name: "DALL-E 3",
                    energy: 2.0,
                    water: 130,
                    waste: 8.0,
                    color: "#EC4899",
                    desc: "Image gen (~2 Wh/image)"
                },
                {
                    id: "midjourney",
                    name: "Midjourney v6",
                    energy: 1.88,
                    water: 120,
                    waste: 7.5,
                    color: "#DB2777",
                    desc: "Premium image gen (~1.9 Wh/image)"
                },
                {
                    id: "stable-diff",
                    name: "Stable Diffusion XL",
                    energy: 1.2,
                    water: 78,
                    waste: 4.8,
                    color: "#9333EA",
                    desc: "Open-source image gen (~1.2 Wh/image)"
                }
            ];

            // Snap values for the slider
            const SNAP_VALUES = [1000, 5000, 10000];
            const SNAP_THRESHOLD = 0.03; // 3% of slider range for snapping

            let activeModels = ["gpt35", "gpt4"];
            let mainChart;
            let currentChartType = "energy"; // Track current chart type: 'energy', 'water', or 'waste'
            let scene,
                camera,
                renderer,
                laneGroups = [];
            let activeSceneType = "energy";
            let threeInitialized = false;
            let raycaster, mouse;
            let hoverLabel = null;
            let resultsShown = false; // Track if results have been shown

            // --- Onboarding ---
            function checkOnboarding() {
                // Check if user has seen onboarding before
                const hasSeenOnboarding = localStorage.getItem("ecoaudit_onboarding_seen");
                if (!hasSeenOnboarding) {
                    document.getElementById("onboardingModal").classList.add("open");
                }
            }

            function closeOnboarding(dontShowAgain = false) {
                document.getElementById("onboardingModal").classList.remove("open");
                if (dontShowAgain) {
                    localStorage.setItem("ecoaudit_onboarding_seen", "true");
                    localStorage.setItem("ecoaudit_tutorial_seen", "true");
                }
            }

            // --- Tutorial System ---
            let currentTutorialStep = 0;
            const tutorialSteps = [
                {
                    target: "#sidebar",
                    title: "Step 1: Select AI Models",
                    desc: "Choose one or more AI models from the sidebar to analyze their environmental impact. Click on any model to select or deselect it.",
                    position: "right"
                },
                {
                    target: "#volInput",
                    title: "Step 2: Set Your Daily Usage",
                    desc: "Adjust the slider or type directly to set how many AI prompts you use each day. This will calculate your environmental footprint.",
                    position: "right"
                },
                {
                    target: ".results-section",
                    title: "Step 3: View Impact Results",
                    desc: "The dashboard automatically shows your environmental impact - including energy consumption, water usage, and e-waste. Results update in real-time as you change settings.",
                    position: "top"
                },
                {
                    target: ".nav-btn:nth-child(2)",
                    title: "Step 4: Explore 3D Visualization",
                    desc: 'Click the "3D Compare" tab to see a stunning 3D comparison of different models. Drag to rotate and scroll to zoom.',
                    position: "bottom"
                },
                {
                    target: "#three-container",
                    title: "Step 5: Interactive 3D Scene",
                    desc: "Hover over objects to see exact numbers. Use the buttons at the bottom to switch between Energy, Water, and E-Waste views. Try it now!",
                    position: "top"
                }
            ];

            function startTutorial() {
                // Close onboarding modal
                document.getElementById("onboardingModal").classList.remove("open");

                // Ensure app is visible
                if (!document.getElementById("app-container").classList.contains("visible")) {
                    enterApp();
                }

                // Wait for app to display
                setTimeout(() => {
                    currentTutorialStep = 0;
                    showTutorialStep(0);
                    document.getElementById("tutorialOverlay").classList.add("active");

                    // Generate progress dots
                    const progressContainer = document.getElementById("tutorialProgress");
                    progressContainer.innerHTML = "";
                    tutorialSteps.forEach((_, index) => {
                        const dot = document.createElement("div");
                        dot.className = `tutorial-progress-dot ${index === 0 ? "active" : ""}`;
                        dot.addEventListener("click", () => {
                            currentTutorialStep = index;
                            showTutorialStep(index);
                        });
                        progressContainer.appendChild(dot);
                    });
                }, 500);
            }

            function showTutorialStep(stepIndex) {
                if (stepIndex < 0 || stepIndex >= tutorialSteps.length) return;

                const step = tutorialSteps[stepIndex];
                const targetElement = document.querySelector(step.target);

                if (!targetElement) {
                    console.warn("Tutorial target not found:", step.target);
                    return;
                }

                // If target is 3D scene, switch to benchmarks tab first
                if (step.target === "#three-container") {
                    const benchmarksBtn = document.querySelectorAll(".nav-btn")[1];
                    if (benchmarksBtn) {
                        switchTab("benchmarks", benchmarksBtn);
                    }
                }

                // Update step content
                document.getElementById("tutorialStepNumber").innerText = stepIndex + 1;
                document.getElementById("tutorialTitle").innerText = step.title;
                document.getElementById("tutorialDesc").innerText = step.desc;

                // Update button text
                const btnText = document.getElementById("tutorialBtnText");
                btnText.innerText = stepIndex === tutorialSteps.length - 1 ? "Finish" : "Next";

                // Update progress dots
                const dots = document.querySelectorAll(".tutorial-progress-dot");
                dots.forEach((dot, index) => {
                    dot.classList.toggle("active", index === stepIndex);
                });

                // Position spotlight
                const rect = targetElement.getBoundingClientRect();
                const spotlight = document.getElementById("tutorialSpotlight");
                const padding = 10;

                spotlight.style.left = rect.left - padding + "px";
                spotlight.style.top = rect.top - padding + "px";
                spotlight.style.width = rect.width + padding * 2 + "px";
                spotlight.style.height = rect.height + padding * 2 + "px";

                // Position tooltip
                const tooltip = document.getElementById("tutorialTooltip");
                const tooltipRect = tooltip.getBoundingClientRect();

                let tooltipX, tooltipY;

                switch (step.position) {
                    case "right":
                        tooltipX = rect.right + 20;
                        tooltipY = rect.top + rect.height / 2 - tooltipRect.height / 2;
                        break;
                    case "left":
                        tooltipX = rect.left - tooltipRect.width - 20;
                        tooltipY = rect.top + rect.height / 2 - tooltipRect.height / 2;
                        break;
                    case "bottom":
                        tooltipX = rect.left + rect.width / 2 - tooltipRect.width / 2;
                        tooltipY = rect.bottom + 20;
                        break;
                    case "top":
                        tooltipX = rect.left + rect.width / 2 - tooltipRect.width / 2;
                        tooltipY = rect.top - tooltipRect.height - 20;
                        break;
                }

                // Ensure tooltip stays within viewport
                tooltipX = Math.max(20, Math.min(tooltipX, window.innerWidth - tooltipRect.width - 20));
                tooltipY = Math.max(20, Math.min(tooltipY, window.innerHeight - tooltipRect.height - 20));

                tooltip.style.left = tooltipX + "px";
                tooltip.style.top = tooltipY + "px";
            }

            function nextTutorialStep() {
                currentTutorialStep++;
                if (currentTutorialStep >= tutorialSteps.length) {
                    // Tutorial complete
                    skipTutorial();
                    showToast("Tutorial complete! You can now explore the app.", "success", 3000);
                } else {
                    showTutorialStep(currentTutorialStep);
                }
            }

            function skipTutorial() {
                document.getElementById("tutorialOverlay").classList.remove("active");
                localStorage.setItem("ecoaudit_tutorial_seen", "true");
                // Navigate to Impact Report (Step 1) after tutorial
                const dashboardBtn = document.querySelector('.nav-btn[aria-controls="dashboard"]');
                if (dashboardBtn) {
                    switchTab("dashboard", dashboardBtn);
                }
            }

            // --- Language Support ---
            const translations = {
                en: {
                    dailyPrompts: "DAILY PROMPTS",
                    promptsPerDay: "Prompts / Day",
                    whatCountsPrompt: "What counts as a prompt?",
                    onePromptEquals: "One prompt = one question or request to an AI.",
                    examplePrompt: 'Example: "Explain climate change" is 1 prompt.',
                    selectModels: "SELECT MODELS",
                    calculateImpact: "Calculate Impact",
                    updateResults: "Update Results",
                    yourAiImpact: "Your AI Impact",
                    impactDesc: "See how your daily AI use affects the environment in simple, everyday terms.",
                    setUsage: "Set Usage",
                    viewResults: "View Results",
                    modelsSelected: "Models Selected",
                    kwhYear: "kWh / Year",
                    lowImpact: "Low Impact",
                    moderate: "Moderate",
                    highImpact: "High Impact",
                    comparedTo: "Compared to Heavy Users",
                    overallRating: "Overall Rating",
                    dailyEnergy: "Daily Energy Use",
                    lightBulbHours: "light bulb hours",
                    bulbExplain: "Same as running a 60 W bulb for this many hours each day",
                    otherFactors: "Other Environmental Factors",
                    waterCooling: "Water for Cooling",
                    bottlesDay: "bottles / day",
                    waterExplain: "500 mL bottles used to cool data centers",
                    ewasteYearly: "E-Waste (Yearly)",
                    phoneEquiv: "phone equivalents",
                    ewasteExplain: "Hardware wear from AI processing (200 g each)",
                    impactReport: "Impact Report",
                    compare3d: "3D Compare",
                    visualComparison: "Visual Comparison",
                    visualDesc: "See the difference between models at a glance.",
                    energy: "Energy",
                    water: "Water",
                    ewaste: "E-Waste",
                    compareActivities: "Compare to Everyday Activities",
                    gamingPc: "Gaming PC 1 hour",
                    laptop: "Laptop 1 hour"
                }
            };

            let currentLang = "en";

            function toggleLangDropdown() {
                const dropdown = document.getElementById("langDropdown");
                if (dropdown) dropdown.classList.toggle("open");
            }

            function setLanguage(lang) {
                currentLang = lang;
                localStorage.setItem("ecoaudit_lang", lang);

                // Update dropdown UI
                document.querySelectorAll(".lang-option").forEach((opt) => {
                    opt.classList.remove("active");
                    if (opt.dataset.lang === lang) opt.classList.add("active");
                });

                // Update current language text
                const langNames = { en: "EN", zh: "ZH", es: "ES" };
                const currentLangText = document.getElementById("currentLangText");
                if (currentLangText) currentLangText.innerText = langNames[lang];

                // Close dropdown
                const langDropdown = document.getElementById("langDropdown");
                if (langDropdown) langDropdown.classList.remove("open");

                // Apply translations (simplified - key UI elements)
                applyTranslations();

                showToast(
                    lang === "en"
                        ? "Language changed to English"
                        : lang === "zh"
                          ? "Language changed to Chinese"
                          : "Idioma cambiado a Espanol",
                    "success",
                    2000
                );
            }

            function applyTranslations() {
                const t = translations[currentLang];
                if (!t) return;

                // Nav buttons
                const navBtns = document.querySelectorAll(".nav-btn");
                if (navBtns[0])
                    navBtns[0].innerHTML = `<i class="fas fa-chart-pie" style="margin-right:8px;"></i>${t.impactReport}`;
                if (navBtns[1])
                    navBtns[1].innerHTML = `<i class="fas fa-cubes" style="margin-right:8px;"></i>${t.compare3d}`;
            }

            function initLanguage() {
                const savedLang = localStorage.getItem("ecoaudit_lang");
                if (savedLang && translations[savedLang]) {
                    setLanguage(savedLang);
                }
            }

            // Close dropdown when clicking outside
            document.addEventListener("click", function (e) {
                if (!e.target.closest(".lang-switcher")) {
                    document.getElementById("langDropdown")?.classList.remove("open");
                }
            });

            // --- Data Sources Toggle ---
            function toggleDataSources() {
                document.getElementById("dataSources").classList.toggle("open");
            }

            // --- View Mode Toggle (Simple/Advanced) ---
            let advancedMode = false;

            function toggleViewMode() {
                advancedMode = !advancedMode;
                const toggle = document.getElementById("viewModeToggle");
                const text = document.getElementById("viewModeText");

                if (advancedMode) {
                    toggle.classList.add("active");
                    text.innerText = "Detailed";
                    // Show advanced sections
                    document.querySelectorAll(".simple-mode-hidden").forEach((el) => el.classList.add("visible"));
                    showToast("Detailed view: showing technical details", "info", 2000);
                } else {
                    toggle.classList.remove("active");
                    text.innerText = "Simple";
                    // Hide advanced sections
                    document.querySelectorAll(".simple-mode-hidden").forEach((el) => el.classList.remove("visible"));
                    showToast("Simple view: showing everyday comparisons", "info", 2000);
                }
            }

            function updateAdvancedData(whDay, kwhYear, mlDay, gramsYear) {
                // Energy data
                document.getElementById("advWhDay").innerText = whDay.toFixed(1) + " Wh";
                document.getElementById("advKwhYear").innerText = kwhYear.toFixed(2) + " kWh";
                // CO2: ~0.4 kg CO2 per kWh (global average)
                const co2Kg = kwhYear * 0.4;
                document.getElementById("advCo2").innerText = co2Kg.toFixed(2) + " kg";

                // Water data
                document.getElementById("advMlDay").innerText = mlDay.toFixed(0) + " mL";
                document.getElementById("advLitersYear").innerText = ((mlDay * 365) / 1000).toFixed(1) + " L";

                // E-Waste data
                document.getElementById("advGramsYear").innerText = gramsYear.toFixed(1) + " g";
                document.getElementById("advKgYear").innerText = (gramsYear / 1000).toFixed(3) + " kg";
            }

            // --- Format numbers ---
            function formatNumber(num) {
                if (num >= 1000000) return (num / 1000000).toFixed(1) + "M";
                if (num >= 1000) return (num / 1000).toFixed(0) + "K";
                return num.toLocaleString();
            }

            // --- Preset button handler (now for prompts) ---
            function setPromptPreset(value) {
                document.getElementById("volSlider").value = value;
                document.getElementById("volInput").value = value;
                updateSnapMarkers(value);
                // Only auto-update if results are already shown
                if (resultsShown) {
                    updateDashboard();
                }
            }

            // --- Slider/Input Sync Functions ---
            function syncSliderFromInput(value) {
                // Allow empty input without forcing to 1
                if (value === '' || value === null) {
                    return;
                }
                let numValue = parseInt(value) || 0;
                if (numValue > 0) {
                    numValue = Math.max(1, Math.min(10000, numValue));
                    document.getElementById("volSlider").value = numValue;
                    document.getElementById("volSlider").setAttribute("aria-valuenow", numValue);
                    updateSnapMarkers(numValue);
                    showResultsAndUpdate();
                }
            }

            function syncInputFromSlider(value) {
                let numValue = parseInt(value) || 1;

                // Apply snapping to nearby preset values
                const sliderMin = 1;
                const sliderMax = 10000;
                const sliderRange = sliderMax - sliderMin;
                const snapRange = sliderRange * SNAP_THRESHOLD;

                for (const snapValue of SNAP_VALUES) {
                    if (Math.abs(numValue - snapValue) <= snapRange) {
                        numValue = snapValue;
                        document.getElementById("volSlider").value = numValue;
                        break;
                    }
                }

                document.getElementById("volInput").value = numValue;
                document.getElementById("volSlider").setAttribute("aria-valuenow", numValue);
                updateSnapMarkers(numValue);
                showResultsAndUpdate();
            }

            function showResultsAndUpdate() {
                if (activeModels.length === 0) return;

                // Show results section if not already shown
                const resultsSection = document.getElementById("resultsSection");
                if (!resultsSection.classList.contains("visible")) {
                    resultsSection.classList.add("visible");
                    resultsShown = true;
                }

                updateDashboard();
            }

            function updateSnapMarkers(currentValue) {
                const markers = document.querySelectorAll(".snap-marker");
                markers.forEach((marker) => {
                    const markerValue = parseInt(marker.dataset.value);
                    if (markerValue === currentValue) {
                        marker.classList.add("active");
                    } else {
                        marker.classList.remove("active");
                    }
                });
            }

            function createSnapMarkers() {
                const container = document.getElementById("snapMarkers");
                if (!container) return;

                container.innerHTML = "";
                const sliderMin = 1;
                const sliderMax = 10000;

                SNAP_VALUES.forEach((value) => {
                    // Calculate position as percentage (using logarithmic scale for better distribution)
                    const logMin = Math.log(sliderMin);
                    const logMax = Math.log(sliderMax);
                    const logValue = Math.log(value);
                    // Use linear scale since slider is linear
                    const percent = ((value - sliderMin) / (sliderMax - sliderMin)) * 100;

                    const marker = document.createElement("div");
                    marker.className = "snap-marker" + (value === 100 ? " active" : "");
                    marker.style.left = percent + "%";
                    marker.dataset.value = value;

                    // Format display value
                    const displayValue = value >= 1000 ? value / 1000 + "K" : value;
                    marker.setAttribute("data-value", displayValue);

                    container.appendChild(marker);
                });
            }

            // --- Calculate Impact (Progressive Disclosure) ---
            function calculateImpact() {
                if (activeModels.length === 0) {
                    showToast("Please select at least one AI model first", "warning", 3000);
                    return;
                }

                // Show results section
                const resultsSection = document.getElementById("resultsSection");
                resultsSection.classList.add("visible");
                resultsShown = true;

                // Actually update the dashboard
                updateDashboard();

                // Scroll to results
                resultsSection.scrollIntoView({ behavior: "smooth", block: "start" });

                showToast("Impact calculated! Scroll down to see results.", "success", 3000);
            }

            // --- Token Calculator Modal ---
            function openTokenModal() {
                document.getElementById("tokenModal").classList.add("open");
                calculateTokens();
            }
            function closeTokenModal() {
                document.getElementById("tokenModal").classList.remove("open");
            }
            function calculateTokens() {
                const prompts = parseInt(document.getElementById("tokenCalcPrompts").value) || 0;
                const TOKENS_PER_PROMPT = 1000; // Average tokens per prompt (including response)
                const tokens = prompts * TOKENS_PER_PROMPT;
                document.getElementById("tokenCalcResult").innerText = tokens.toLocaleString();
            }

            // --- Fullscreen 3D ---
            let isFullscreen = false;
            let originalParent = null;

            function openFullscreen3D() {
                if (!threeInitialized || !renderer) {
                    showToast("Please wait for 3D view to load first", "warning", 3000);
                    return;
                }

                isFullscreen = true;
                const modal = document.getElementById("fullscreen3D");
                const fullscreenContainer = document.getElementById("three-container-fullscreen");
                originalParent = renderer.domElement.parentElement;

                // Move the canvas to fullscreen container
                fullscreenContainer.appendChild(renderer.domElement);
                modal.classList.add("open");

                // Add mouse event handlers to fullscreen container for drag rotation
                fullscreenContainer.addEventListener("mousemove", onMouseMoveFullscreen);
                fullscreenContainer.addEventListener("mousedown", onMouseDown);
                fullscreenContainer.addEventListener("mouseup", onMouseUp);
                fullscreenContainer.addEventListener("mouseleave", onMouseUp);
                fullscreenContainer.addEventListener("wheel", onMouseWheel, { passive: false });
                fullscreenContainer.style.cursor = "grab";

                // Copy legend to fullscreen (left side, below top)
                const legendContainer = document.createElement("div");
                legendContainer.id = "legendContainerFullscreen";
                legendContainer.style.cssText = "position:absolute; top:80px; left:20px; z-index:5; display:flex; flex-direction:column; gap:4px;";
                const legend = document.getElementById("laneLegend").cloneNode(true);
                legend.id = "laneLegendFullscreen";
                legend.style.display = "flex";
                legend.style.flexDirection = "column";
                legend.style.gap = "4px";
                legendContainer.appendChild(legend);
                fullscreenContainer.appendChild(legendContainer);

                // Copy zoom controls to fullscreen (bottom left)
                const zoomControlsHTML = `
                <div style="position:absolute; bottom:20px; left:20px; display:flex; flex-direction:column; gap:8px; z-index:10;">
                    <button type="button" class="t-btn" onclick="zoom3D(0.8)" title="Zoom In" style="padding:0; display:flex; align-items:center; gap:10px; background:transparent; border:none;">
                        <span style="width:36px; height:36px; border-radius:50%; border:1px solid #8ff1b6; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.1);"><i class="fas fa-search-plus"></i></span>
                        <span style="font-size:0.75rem;">Zoom In</span>
                    </button>
                    <button type="button" class="t-btn" onclick="zoom3D(1.25)" title="Zoom Out" style="padding:0; display:flex; align-items:center; gap:10px; background:transparent; border:none;">
                        <span style="width:36px; height:36px; border-radius:50%; border:1px solid #8ff1b6; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.1);"><i class="fas fa-search-minus"></i></span>
                        <span style="font-size:0.75rem;">Zoom Out</span>
                    </button>
                    <button type="button" class="t-btn" onclick="resetZoom()" title="Reset View" style="padding:0; display:flex; align-items:center; gap:10px; background:transparent; border:none;">
                        <span style="width:36px; height:36px; border-radius:50%; border:1px solid #8ff1b6; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.1);"><i class="fas fa-undo"></i></span>
                        <span style="font-size:0.75rem;">Reset</span>
                    </button>
                </div>
            `;
                const zoomControlsDiv = document.createElement("div");
                zoomControlsDiv.innerHTML = zoomControlsHTML;
                fullscreenContainer.appendChild(zoomControlsDiv.firstElementChild);

                // Copy controls to fullscreen
                const controls = document.querySelector(".three-controls").cloneNode(true);
                controls.style.position = "absolute";
                controls.style.bottom = "20px";
                controls.style.left = "50%";
                controls.style.transform = "translateX(-50%)";
                fullscreenContainer.appendChild(controls);

                // Copy meta info
                const metaInfo = document.createElement("div");
                metaInfo.style.cssText = "position:absolute; bottom:70px; right:20px; text-align:right;";
                metaInfo.innerHTML = `
                <div style="color:#fff; font-weight:800; font-size:1rem;">${document.getElementById("metaTitle").innerText}</div>
                <div style="color:#888; font-size:0.75rem;">${document.getElementById("metaSubtitle").innerText}</div>
            `;
                fullscreenContainer.appendChild(metaInfo);

                // Create hover label for fullscreen
                if (!fullscreenContainer.querySelector(".hover-label-fullscreen")) {
                    const hoverLabelFullscreen = document.createElement("div");
                    hoverLabelFullscreen.className = "hover-label-fullscreen";
                    hoverLabelFullscreen.style.cssText =
                        "position:absolute; background:rgba(0,0,0,0.85); color:#fff; padding:8px 12px; border-radius:6px; font-size:0.85rem; font-weight:600; pointer-events:none; opacity:0; transition:opacity 0.2s; z-index:100; border:1px solid rgba(255,255,255,0.2);";
                    fullscreenContainer.appendChild(hoverLabelFullscreen);
                }

                // Resize renderer
                setTimeout(() => {
                    renderer.setSize(window.innerWidth, window.innerHeight);
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                }, 50);

                showToast("Press ESC or click Close to exit fullscreen", "info", 3000);
            }

            // Separate mouse move handler for fullscreen mode
            function onMouseMoveFullscreen(event) {
                const container = document.getElementById("three-container-fullscreen");
                if (!container || !raycaster || !camera) return;

                // Handle drag rotation
                if (isDragging) {
                    const deltaX = event.clientX - previousMousePosition.x;
                    const deltaY = event.clientY - previousMousePosition.y;

                    cameraRotation.y += deltaX * 0.01;
                    cameraRotation.x += deltaY * 0.01;

                    // Clamp vertical rotation
                    cameraRotation.x = Math.max(-Math.PI / 3, Math.min(Math.PI / 3, cameraRotation.x));

                    updateCameraPosition();

                    previousMousePosition = {
                        x: event.clientX,
                        y: event.clientY
                    };
                    container.style.cursor = "grabbing";
                    return;
                }

                container.style.cursor = "grab";

                // Hover detection
                const rect = container.getBoundingClientRect();
                mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

                raycaster.setFromCamera(mouse, camera);

                // Check intersections with lane groups
                let intersected = null;
                let intersectedModelIndex = -1;

                for (let i = 0; i < laneGroups.length; i++) {
                    const group = laneGroups[i];
                    if (group && group.children.length > 0) {
                        const intersects = raycaster.intersectObjects(group.children, true);
                        if (intersects.length > 0) {
                            intersected = intersects[0];
                            intersectedModelIndex = i;
                            break;
                        }
                    }
                }

                const hoverLabelFS = container.querySelector(".hover-label-fullscreen");
                if (intersected && intersectedModelIndex >= 0 && activeModels[intersectedModelIndex]) {
                    const model = MODELS.find((m) => m.id === activeModels[intersectedModelIndex]);
                    if (model && hoverLabelFS) {
                        const prompts = parseInt(document.getElementById("volSlider").value);

                        let rawCount, unitName;
                        if (activeSceneType === "energy") {
                            const wh = model.energy * prompts;
                            rawCount = wh / 60;
                            unitName = "Light Bulbs";
                        } else if (activeSceneType === "water") {
                            const ml = model.water * prompts;
                            rawCount = ml / 500;
                            unitName = "Water Bottles";
                        } else if (activeSceneType === "waste") {
                            const wasteGrams = (model.waste * prompts * 365) / 1000;
                            rawCount = wasteGrams / 200;
                            unitName = "Phones/Year";
                        }

                        // Use same formatting as legend
                        const count = rawCount < 1 ? rawCount.toFixed(2) : Math.round(rawCount);

                        hoverLabelFS.innerHTML = `
                        <div style="display: flex; flex-direction: column; gap: 4px;">
                            <div style="font-weight: 700;">
                                <span style="color:${model.color}">â—</span> ${model.name}
                            </div>
                            <div style="font-size: 1.1rem; font-weight: 800; color: ${model.color};">
                                ${count} ${unitName}
                            </div>
                        </div>
                    `;
                        hoverLabelFS.style.left = event.clientX - rect.left + 15 + "px";
                        hoverLabelFS.style.top = event.clientY - rect.top - 10 + "px";
                        hoverLabelFS.style.opacity = "1";
                    }
                } else if (hoverLabelFS) {
                    hoverLabelFS.style.opacity = "0";
                }
            }

            function closeFullscreen3D() {
                if (!isFullscreen) return;

                isFullscreen = false;
                const modal = document.getElementById("fullscreen3D");
                const fullscreenContainer = document.getElementById("three-container-fullscreen");
                const originalContainer = document.getElementById("three-container");

                // Remove event listeners from fullscreen container
                fullscreenContainer.removeEventListener("mousemove", onMouseMoveFullscreen);
                fullscreenContainer.removeEventListener("mousedown", onMouseDown);
                fullscreenContainer.removeEventListener("mouseup", onMouseUp);
                fullscreenContainer.removeEventListener("mouseleave", onMouseUp);
                fullscreenContainer.removeEventListener("wheel", onMouseWheel);

                // Move canvas back - insert as first child of originalContainer
                if (renderer && originalContainer) {
                    originalContainer.insertBefore(renderer.domElement, originalContainer.firstChild);
                }

                // Remove cloned elements
                const clonedLegend = document.getElementById("laneLegendFullscreen");
                if (clonedLegend) clonedLegend.remove();

                // Clear fullscreen container (remove cloned controls and meta info)
                while (fullscreenContainer.firstChild) {
                    fullscreenContainer.removeChild(fullscreenContainer.firstChild);
                }

                modal.classList.remove("open");

                // Resize renderer back
                setTimeout(onWindowResize, 50);
            }

            // --- HCI: Toast Notification System ---
            function showToast(message, type = "info", duration = 3000) {
                const container = document.getElementById("toastContainer");
                const toast = document.createElement("div");
                toast.className = `toast ${type}`;
                toast.innerHTML = `<i class="fas fa-${type === "success" ? "check-circle" : type === "warning" ? "exclamation-triangle" : type === "error" ? "times-circle" : "info-circle"}" style="margin-right:8px;"></i>${message}`;
                container.appendChild(toast);

                requestAnimationFrame(() => toast.classList.add("show"));

                setTimeout(() => {
                    toast.classList.remove("show");
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            }

            // --- HCI: Keyboard Navigation ---
            document.addEventListener("keydown", function (e) {
                if (e.key === "Enter" && !document.getElementById("landing-layer").classList.contains("hidden")) {
                    enterApp();
                    return;
                }

                if (e.key === "Escape") {
                    closeModal();
                    closeTokenModal();
                    closeFullscreen3D();
                    document.getElementById("sidebar").classList.remove("open");
                }

                if (e.key === "1" && !e.ctrlKey && !e.altKey && document.activeElement.tagName !== "INPUT") {
                    const btn = document.querySelector(".nav-btn");
                    switchTab("dashboard", btn);
                }
                if (e.key === "2" && !e.ctrlKey && !e.altKey && document.activeElement.tagName !== "INPUT") {
                    const btn = document.querySelectorAll(".nav-btn")[1];
                    switchTab("benchmarks", btn);
                }

                if (e.key === "?" && !e.ctrlKey) {
                    showHelp();
                }
            });

            function showHelp() {
                // /é”Ÿçµ
                if (!document.getElementById("app-container").classList.contains("visible")) {
                    enterApp();
                    setTimeout(() => startTutorial(), 500);
                } else {
                    startTutorial();
                }
            }

            function toggleSidebar() {
                document.getElementById("sidebar").classList.toggle("open");
            }

            function toggleSidebarVisibility() {
                const layout = document.getElementById("mainLayout");
                const toggle = document.getElementById("sidebarToggle");
                layout.classList.toggle("sidebar-hidden");

                // Update toggle button icon
                const icon = toggle.querySelector("i");
                if (layout.classList.contains("sidebar-hidden")) {
                    icon.className = "fas fa-chevron-right";
                    icon.style.color = "#c9eed8";
                } else {
                    icon.className = "fas fa-chevron-left";
                    icon.style.color = "#c9eed8";
                }
            }

            function enterApp() {
                document.getElementById("landing-layer").classList.add("hidden");
                document.getElementById("app-container").classList.add("visible");
                // Clean up animations
                if (window.particlesAnimationId) {
                    cancelAnimationFrame(window.particlesAnimationId);
                }
                if (window.brain3dAnimationId) {
                    cancelAnimationFrame(window.brain3dAnimationId);
                }
                // Show onboarding for first-time visitors
                checkOnboarding();
                showToast("Select AI models and click Calculate to see impact", "success");
            }

            // ===== LANDING PAGE PARTICLES ANIMATION =====
            function initLandingParticles() {
                const canvas = document.getElementById("landing-particles");
                if (!canvas) return;

                const ctx = canvas.getContext("2d");
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;

                const particles = [];
                const particleCount = 80;
                const connectionDistance = 150;

                class Particle {
                    constructor() {
                        this.x = Math.random() * canvas.width;
                        this.y = Math.random() * canvas.height;
                        this.vx = (Math.random() - 0.5) * 0.5;
                        this.vy = (Math.random() - 0.5) * 0.5;
                        this.radius = Math.random() * 2 + 1;
                        this.opacity = Math.random() * 0.5 + 0.3;
                    }

                    update() {
                        this.x += this.vx;
                        this.y += this.vy;

                        if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
                        if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
                    }

                    draw() {
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(59, 130, 246, ${this.opacity})`;
                        ctx.fill();
                        ctx.closePath();
                    }
                }

                // Create particles
                for (let i = 0; i < particleCount; i++) {
                    particles.push(new Particle());
                }

                function connectParticles() {
                    for (let i = 0; i < particles.length; i++) {
                        for (let j = i + 1; j < particles.length; j++) {
                            const dx = particles[i].x - particles[j].x;
                            const dy = particles[i].y - particles[j].y;
                            const distance = Math.sqrt(dx * dx + dy * dy);

                            if (distance < connectionDistance) {
                                const opacity = (1 - distance / connectionDistance) * 0.3;
                                ctx.beginPath();
                                ctx.strokeStyle = `rgba(59, 130, 246, ${opacity})`;
                                ctx.lineWidth = 1;
                                ctx.moveTo(particles[i].x, particles[i].y);
                                ctx.lineTo(particles[j].x, particles[j].y);
                                ctx.stroke();
                                ctx.closePath();
                            }
                        }
                    }
                }

                function animate() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    particles.forEach((particle) => {
                        particle.update();
                        particle.draw();
                    });

                    connectParticles();

                    window.particlesAnimationId = requestAnimationFrame(animate);
                }

                animate();

                // Resize handler
                window.addEventListener("resize", () => {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                });
            }

            // ===== 3D BRAIN VISUALIZATION =====
            function init3DBrain() {
                const canvas = document.getElementById("brain3d");
                if (!canvas) return;

                const ctx = canvas.getContext("2d");
                const width = (canvas.width = canvas.offsetWidth);
                const height = (canvas.height = canvas.offsetHeight);

                // Brain structure - create a network of nodes
                const nodes = [];
                const connections = [];
                const nodeCount = 120;
                const centerX = width / 2;
                const centerY = height / 2;

                // Create nodes in a brain-like shape (two hemispheres)
                for (let i = 0; i < nodeCount; i++) {
                    const theta = Math.random() * Math.PI * 2;
                    const phi = Math.random() * Math.PI;
                    const radius = 120 + Math.random() * 80;

                    // Create brain-like shape (ellipsoid)
                    const x = radius * Math.sin(phi) * Math.cos(theta) * 1.2;
                    const y = radius * Math.sin(phi) * Math.sin(theta) * 0.8;
                    const z = radius * Math.cos(phi);

                    nodes.push({
                        x: x,
                        y: y,
                        z: z,
                        vx: (Math.random() - 0.5) * 0.1,
                        vy: (Math.random() - 0.5) * 0.1,
                        vz: (Math.random() - 0.5) * 0.1,
                        connections: []
                    });
                }

                // Create connections between nearby nodes
                for (let i = 0; i < nodes.length; i++) {
                    for (let j = i + 1; j < nodes.length; j++) {
                        const dx = nodes[i].x - nodes[j].x;
                        const dy = nodes[i].y - nodes[j].y;
                        const dz = nodes[i].z - nodes[j].z;
                        const distance = Math.sqrt(dx * dx + dy * dy + dz * dz);

                        if (distance < 100 && Math.random() > 0.7) {
                            connections.push({ from: i, to: j });
                            nodes[i].connections.push(j);
                        }
                    }
                }

                let rotationY = 0;
                let rotationX = 0;

                function project(node, rotX, rotY) {
                    // Rotate around Y axis
                    let x = node.x;
                    let y = node.y;
                    let z = node.z;

                    // Rotate Y
                    const cosY = Math.cos(rotY);
                    const sinY = Math.sin(rotY);
                    const tempX = x * cosY - z * sinY;
                    const tempZ = x * sinY + z * cosY;
                    x = tempX;
                    z = tempZ;

                    // Rotate X
                    const cosX = Math.cos(rotX);
                    const sinX = Math.sin(rotX);
                    const tempY = y * cosX - z * sinX;
                    z = y * sinX + z * cosX;
                    y = tempY;

                    // Perspective projection
                    const perspective = 600;
                    const scale = perspective / (perspective + z);

                    return {
                        x: centerX + x * scale,
                        y: centerY + y * scale,
                        scale: scale,
                        z: z
                    };
                }

                function drawBrain() {
                    ctx.clearRect(0, 0, width, height);

                    // Update rotation
                    rotationY += 0.003;
                    rotationX = Math.sin(rotationY * 0.5) * 0.2;

                    // Project all nodes
                    const projectedNodes = nodes.map((node) => project(node, rotationX, rotationY));

                    // Sort by z-depth for proper rendering
                    const sortedIndices = projectedNodes
                        .map((node, idx) => ({ idx, z: node.z }))
                        .sort((a, b) => a.z - b.z)
                        .map((item) => item.idx);

                    // Draw connections first (behind nodes)
                    ctx.strokeStyle = "rgba(59, 130, 246, 0.15)";
                    ctx.lineWidth = 1;

                    connections.forEach((conn) => {
                        const from = projectedNodes[conn.from];
                        const to = projectedNodes[conn.to];

                        const opacity = (from.scale + to.scale) / 4;
                        ctx.strokeStyle = `rgba(59, 130, 246, ${opacity * 0.3})`;
                        ctx.beginPath();
                        ctx.moveTo(from.x, from.y);
                        ctx.lineTo(to.x, to.y);
                        ctx.stroke();
                    });

                    // Draw nodes
                    sortedIndices.forEach((idx) => {
                        const projected = projectedNodes[idx];
                        const nodeSize = 2 * projected.scale;
                        const opacity = projected.scale * 0.8;

                        // Glow effect
                        const gradient = ctx.createRadialGradient(
                            projected.x,
                            projected.y,
                            0,
                            projected.x,
                            projected.y,
                            nodeSize * 3
                        );
                        gradient.addColorStop(0, `rgba(59, 130, 246, ${opacity})`);
                        gradient.addColorStop(1, "rgba(59, 130, 246, 0)");

                        ctx.fillStyle = gradient;
                        ctx.beginPath();
                        ctx.arc(projected.x, projected.y, nodeSize * 3, 0, Math.PI * 2);
                        ctx.fill();

                        // Core node
                        ctx.fillStyle = `rgba(52, 211, 153, ${opacity})`;
                        ctx.beginPath();
                        ctx.arc(projected.x, projected.y, nodeSize, 0, Math.PI * 2);
                        ctx.fill();
                    });

                    window.brain3dAnimationId = requestAnimationFrame(drawBrain);
                }

                drawBrain();
            }

            function init() {
                const list = document.getElementById("modelList");
                // Sort models alphabetically by name
                const sortedModels = [...MODELS].sort((a, b) => a.name.localeCompare(b.name));
                sortedModels.forEach((m) => {
                    const div = document.createElement("div");
                    div.className = `model-card ${activeModels.includes(m.id) ? "active" : ""}`;
                    div.style.borderLeft = `3px solid ${m.color}`;
                    div.setAttribute("role", "option");
                    div.setAttribute("aria-selected", activeModels.includes(m.id));
                    div.setAttribute("tabindex", "0");

                    // IMPROVED: Info button instead of double-click
                    div.innerHTML = `
                    <div class="custom-check"></div>
                    <span style="flex:1; margin-left:10px; color:#eee; font-weight:600; font-size:0.85rem;">${m.name}</span>
                    <div class="model-color-dot" style="background:${m.color}; color:${m.color};"></div>
                    <button class="model-info-btn" onclick="event.stopPropagation(); showDetails('${m.id}')" title="View model details" aria-label="Info about ${m.name}">
                        <i class="fas fa-info"></i>
                    </button>
                `;

                    div.onclick = (e) => {
                        if (!e.target.closest(".model-info-btn")) {
                            toggleModel(m.id, div);
                        }
                    };

                    div.onkeydown = (e) => {
                        if (e.key === "Enter" || e.key === " ") {
                            e.preventDefault();
                            toggleModel(m.id, div);
                        }
                    };
                    list.appendChild(div);
                });

                initCharts();
                createSnapMarkers(); // Initialize snap markers on slider
                initLanguage(); // Initialize saved language preference

                // Force update dashboard with initial data
                // This ensures data is displayed even before user interaction
                if (activeModels.length > 0) {
                    const resultsSection = document.getElementById("resultsSection");
                    resultsSection.classList.add("visible");
                    resultsShown = true;
                    updateDashboard();
                }
            }

            function initCharts() {
                // Main chart with model names only on x-axis (below bars)
                const mainOpts = {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        datalabels: { display: false }, // No labels above bars
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const value = context.parsed.y;
                                    if (currentChartType === "water") {
                                        return value.toLocaleString() + " mL/day";
                                    } else if (currentChartType === "waste") {
                                        return value.toFixed(1) + " g/year";
                                    } else {
                                        return value.toFixed(1) + " Wh/day";
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            ticks: {
                                color: "#fff",
                                font: { weight: "bold", size: 10 },
                                maxRotation: 45,
                                minRotation: 0
                            },
                            grid: { display: false }
                        },
                        y: {
                            grid: { color: "#1e293b" },
                            ticks: {
                                color: "#888",
                                callback: function (value) {
                                    if (currentChartType === "water") {
                                        return value.toLocaleString() + " mL";
                                    } else if (currentChartType === "waste") {
                                        return value + " g";
                                    } else {
                                        return value + " Wh";
                                    }
                                }
                            }
                        }
                    }
                };

                mainChart = new Chart(document.getElementById("mainChart").getContext("2d"), {
                    type: "bar",
                    data: { labels: [], datasets: [{ data: [], borderRadius: 4 }] },
                    options: mainOpts
                });
            }

            function switchChart(type) {
                // Update current chart type
                currentChartType = type;

                // Update tab active states
                document.querySelectorAll(".chart-tab").forEach((tab) => {
                    tab.classList.remove("active");
                    if (tab.dataset.chart === type) {
                        tab.classList.add("active");
                    }
                });

                // Update the chart with new data
                updateCharts(parseInt(document.getElementById("volSlider").value));
            }

            function toggleModel(id, div) {
                const model = MODELS.find((x) => x.id === id);
                if (activeModels.includes(id)) {
                    activeModels = activeModels.filter((x) => x !== id);
                    div.classList.remove("active");
                    div.setAttribute("aria-selected", "false");
                    showToast(`${model.name} removed`, "info", 2000);
                } else {
                    activeModels.push(id);
                    div.classList.add("active");
                    div.setAttribute("aria-selected", "true");
                    showToast(`${model.name} added`, "success", 2000);
                }

                if (activeModels.length === 0) {
                    showToast("Select at least one model to see impact", "warning", 3000);
                }

                // Auto-update results
                showResultsAndUpdate();
            }

            function updateDashboard() {
                // Get prompts value
                const prompts = parseInt(document.getElementById("volSlider").value);
                document.getElementById("volInput").value = prompts;

                const slider = document.getElementById("volSlider");
                slider.setAttribute("aria-valuenow", prompts);

                // Calculate totals (energy=Wh, water=mL, waste=mg)
                let totalWh = 0,
                    totalWaterMl = 0,
                    totalWasteMg = 0;
                activeModels.forEach((id) => {
                    const m = MODELS.find((x) => x.id === id);
                    totalWh += m.energy * prompts; // Wh per day
                    totalWaterMl += m.water * prompts; // mL per day
                    totalWasteMg += m.waste * prompts; // mg per day
                });

                // Update Quick Summary
                document.getElementById("selectedCount").innerText = activeModels.length;
                document.getElementById("totalQueries").innerText = formatNumber(prompts);
                const yearlyKwh = ((totalWh * 365) / 1000).toFixed(1); // Wh -> kWh/year
                document.getElementById("totalKwh").innerText = parseFloat(yearlyKwh).toLocaleString();


                // Update Cards
                // Energy: light bulb hours (60W bulb)
                const bulbHours = (totalWh / 60).toFixed(1);
                // Water: 500mL bottles
                const bottles = Math.round(totalWaterMl / 500);
                // E-Waste: phones per year (200g = 200000mg)
                const yearlyWasteMg = totalWasteMg * 365;
                const yearlyWasteG = yearlyWasteMg / 1000; // mg -> g
                const phones = (yearlyWasteG / 200).toFixed(2);

                document.getElementById("humanEnergy").innerText = bulbHours;
                document.getElementById("humanWater").innerText = bottles.toLocaleString();
                document.getElementById("humanWaste").innerText = phones;

                // Update severity badges for all three cards
                updateSeverityBadge("energy", parseFloat(bulbHours), 1, 5);
                updateSeverityBadge("water", bottles, 2, 20);
                updateSeverityBadge("waste", parseFloat(phones), 0.5, 2);

                // Update simplified rating
                updateRating((totalWh * 365) / 1000);

                // Update Advanced Data (detailed technical values)
                updateAdvancedData(totalWh, (totalWh * 365) / 1000, totalWaterMl, yearlyWasteG);

                // Update Charts
                updateCharts(prompts);

                if (threeInitialized) update3DMultiLane(prompts);
            }

            // Simplified severity badge update
            function updateSeverityBadge(type, value, lowThreshold, highThreshold) {
                const badge = document.getElementById(type + "Severity");

                // Safety check
                if (!badge) {
                    console.warn("Badge element not found for type:", type);
                    return;
                }

                if (value <= lowThreshold) {
                    badge.className = "severity-badge good";
                    badge.innerHTML = '<i class="fas fa-check-circle"></i> High Efficiency';
                } else if (value <= highThreshold) {
                    badge.className = "severity-badge moderate";
                    badge.innerHTML = '<i class="fas fa-exclamation-circle"></i> Moderate';
                } else {
                    badge.className = "severity-badge critical";
                    badge.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Low Efficiency';
                }
            }

            function updateCharts(prompts) {
                const labels = [],
                    data = [],
                    colors = [];

                // Add AI model data based on current chart type
                activeModels.forEach((id) => {
                    const m = MODELS.find((x) => x.id === id);
                    let value;

                    if (currentChartType === "water") {
                        // Water: mL per day
                        value = (m.water * prompts).toFixed(0);
                        labels.push(m.name);
                        data.push(parseFloat(value));
                    } else if (currentChartType === "waste") {
                        // E-Waste: grams per year (mg -> g)
                        value = ((m.waste * prompts * 365) / 1000).toFixed(1);
                        labels.push(m.name);
                        data.push(parseFloat(value));
                    } else {
                        // Energy: Wh per day
                        value = (m.energy * prompts).toFixed(1);
                        labels.push(m.name);
                        data.push(parseFloat(value));
                    }
                    colors.push(m.color);
                });

                // Add daily activity comparisons based on chart type
                if (currentChartType === "water") {
                    // Shower: ~50L = 50000mL
                    labels.push("5-min Shower");
                    data.push(50000);
                    colors.push("#6B7280");

                    // Dishwasher: ~15L = 15000mL
                    labels.push("Dishwasher");
                    data.push(15000);
                    colors.push("#9CA3AF");
                } else if (currentChartType === "waste") {
                    // Smartphone: ~200g
                    labels.push("Smartphone");
                    data.push(200);
                    colors.push("#6B7280");

                    // USB Cable: ~30g
                    labels.push("USB Cable");
                    data.push(30);
                    colors.push("#9CA3AF");
                } else {
                    // Gaming PC: ~300W for 1 hour = 300Wh
                    labels.push("Gaming PC (1h)");
                    data.push(300);
                    colors.push("#6B7280");

                    // Laptop: ~50W for 1 hour = 50Wh
                    labels.push("Laptop (1h)");
                    data.push(50);
                    colors.push("#9CA3AF");
                }

                mainChart.data.labels = labels;
                mainChart.data.datasets[0].data = data;
                mainChart.data.datasets[0].backgroundColor = colors;
                mainChart.update();

                // Update Impact Table in 3D Compare
                updateImpactTable(prompts);
            }

            // SIMPLIFIED: Rating without A-G scale (per feedback about confusion)
            function updateImpactTable(prompts) {
                const tableBody = document.getElementById("impactDetailsBody");
                if (!tableBody) return;

                if (activeModels.length === 0) {
                    tableBody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 20px; color: #64748b;">
                            <i class="fas fa-info-circle" style="margin-right: 8px;"></i>
                            Select models to see impact details
                        </td>
                    </tr>
                `;
                    return;
                }

                let html = "";
                activeModels.forEach((id) => {
                    const m = MODELS.find((x) => x.id === id);
                    if (!m) return;

                    // Energy (Wh per day)
                    const energy = (m.energy * prompts).toFixed(1);
                    const energyBulbs = (m.energy * prompts / 60).toFixed(1); // 60Wh per bulb

                    // Water (mL per day -> Liters)
                    const waterMl = m.water * prompts;
                    const waterLiters = (waterMl / 1000).toFixed(2);
                    const waterBottles = (waterMl / 500).toFixed(1); // 500mL bottles

                    // E-Waste (mg per day -> g per year)
                    const wasteMgYear = m.waste * prompts * 365;
                    const wasteGrams = wasteMgYear / 1000;
                    const wastePhones = (wasteGrams / 200).toFixed(2); // 200g per phone

                    html += `
                    <tr>
                        <td>
                            <div class="model-name">
                                <span class="model-color" style="background: ${m.color}"></span>
                                ${m.name}
                            </div>
                        </td>
                        <td>
                            <div class="value-primary">${energy} Wh/day</div>
                            <div class="value-secondary">${energyBulbs} bulbs</div>
                        </td>
                        <td>
                            <div class="value-primary">${waterLiters} L/day</div>
                            <div class="value-secondary">${waterBottles} bottles</div>
                        </td>
                        <td>
                            <div class="value-primary">${wasteGrams.toFixed(1)} g/yr</div>
                            <div class="value-secondary">${wastePhones} phones</div>
                        </td>
                    </tr>
                `;
                });

                tableBody.innerHTML = html;
            }

            // SIMPLIFIED: Rating without A-G scale (per feedback about confusion)
            function updateRating(val) {
                let title, desc, color;

                if (val < 10) {
                    title = "Great efficiency";
                    color = "#009640";
                    desc = "Your AI usage has minimal environmental impact. Keep it up!";
                } else if (val < 50) {
                    title = "Good efficiency";
                    color = "#52AE32";
                    desc = "Your impact is below average. Consider efficient models for simple tasks.";
                } else if (val < 150) {
                    title = "Moderate impact";
                    color = "#FFED00";
                    desc = "Room for improvement. Try Claude or Mistral for lighter tasks.";
                } else if (val < 400) {
                    title = "Above average impact";
                    color = "#FBBA00";
                    desc = "Consider if all tasks need powerful models like GPT-4.";
                } else {
                    title = "High impact";
                    color = "#E30613";
                    desc = "Consider reducing usage or switching to more efficient models.";
                }

                if (activeModels.length === 0) {
                    title = "Select a model";
                    color = "#333";
                    desc = "Choose at least one AI model to see your environmental impact.";
                }

                const card = document.getElementById("scoreCard");
                card.style.borderColor = color;
                card.style.boxShadow = `0 0 30px ${color}20`;

                // Update the main display with title directly
                const gTxt = document.getElementById("displayGrade");
                gTxt.innerText = title;
                gTxt.style.color = color;

                // Remove the desc element or update it to show the context
                document.getElementById("displayTitle").innerText = desc;
                document.getElementById("displayContext").innerText = "";
            }

            // =====================================================
            // 3D ENGINE
            // =====================================================

            const THREE_CONFIG = {
                objectSize: { energy: 0.3, water: 0.2, waste: 0.4 },
                spacing: 1.0,
                maxObjects: 150,
                camera: { baseY: 6, baseZ: 10 } // Reduced from 10/18 to bring objects closer
            };

            let zoomLevel = 1.0; // Track current zoom
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };
            let cameraRotation = { x: 0, y: 0 }; // Track camera rotation angles
            

            function initThree() {
                const container = document.getElementById("three-container");
                if (!container) return;

                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x050510);
                scene.fog = new THREE.FogExp2(0x050510, 0.015);

                const aspect = container.clientWidth / container.clientHeight;
                camera = new THREE.PerspectiveCamera(50, aspect, 0.1, 200);
                camera.position.set(0, THREE_CONFIG.camera.baseY, THREE_CONFIG.camera.baseZ);
                camera.lookAt(0, 0, 0);

                renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(container.clientWidth, container.clientHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                renderer.shadowMap.enabled = true;
                container.appendChild(renderer.domElement);

                // Initialize raycaster for hover detection
                raycaster = new THREE.Raycaster();
                mouse = new THREE.Vector2();

                // Create hover label element
                hoverLabel = document.createElement("div");
                hoverLabel.style.cssText =
                    "position:absolute; background:rgba(0,0,0,0.85); color:#fff; padding:8px 12px; border-radius:6px; font-size:0.85rem; font-weight:600; pointer-events:none; opacity:0; transition:opacity 0.2s; z-index:100; border:1px solid rgba(255,255,255,0.2);";
                container.appendChild(hoverLabel);

                // Mouse move for hover detection
                container.addEventListener("mousemove", onMouseMove);

                // Mouse drag for rotation
                container.addEventListener("mousedown", onMouseDown);
                container.addEventListener("mouseup", onMouseUp);
                container.addEventListener("mouseleave", onMouseUp);

                // Mouse wheel for zoom
                container.addEventListener("wheel", onMouseWheel, { passive: false });

                addLights();
                addGroundGrid();

                window.addEventListener("resize", onWindowResize);

                animate3D();
                threeInitialized = true;

                const prompts = parseInt(document.getElementById("volSlider").value);
                update3DMultiLane(prompts);
            }

            function onMouseDown(event) {
                isDragging = true;
                previousMousePosition = {
                    x: event.clientX,
                    y: event.clientY
                };
                const container = document.getElementById("three-container");
                if (container) container.style.cursor = "grabbing";
            }

            function onMouseUp() {
                isDragging = false;
                const container = document.getElementById("three-container");
                if (container) container.style.cursor = "grab";
            }

            function onMouseMove(event) {
                const container = document.getElementById("three-container");
                if (!container || !raycaster || !camera) return;

                // Handle drag rotation
                if (isDragging) {
                    const deltaX = event.clientX - previousMousePosition.x;
                    const deltaY = event.clientY - previousMousePosition.y;

                    cameraRotation.y += deltaX * 0.01;
                    cameraRotation.x += deltaY * 0.01;

                    // Clamp vertical rotation
                    cameraRotation.x = Math.max(-Math.PI / 3, Math.min(Math.PI / 3, cameraRotation.x));

                    updateCameraPosition();

                    previousMousePosition = {
                        x: event.clientX,
                        y: event.clientY
                    };
                    return;
                }

                // Hover detection
                const rect = container.getBoundingClientRect();
                mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

                raycaster.setFromCamera(mouse, camera);

                // Check intersections with lane groups
                let intersected = null;
                let intersectedModelIndex = -1;

                for (let i = 0; i < laneGroups.length; i++) {
                    const group = laneGroups[i];
                    if (group && group.children.length > 0) {
                        const intersects = raycaster.intersectObjects(group.children, true);
                        if (intersects.length > 0) {
                            intersected = intersects[0];
                            intersectedModelIndex = i;
                            break;
                        }
                    }
                }

                if (intersected && intersectedModelIndex >= 0 && activeModels[intersectedModelIndex]) {
                    const model = MODELS.find((m) => m.id === activeModels[intersectedModelIndex]);
                    if (model && hoverLabel) {
                        const prompts = parseInt(document.getElementById("volSlider").value);

                        let rawCount, unitName;
                        if (activeSceneType === "energy") {
                            const wh = model.energy * prompts;
                            rawCount = wh / 60;
                            unitName = "Light Bulbs";
                        } else if (activeSceneType === "water") {
                            const ml = model.water * prompts;
                            rawCount = ml / 500;
                            unitName = "Water Bottles";
                        } else if (activeSceneType === "waste") {
                            // mg per day -> g per year -> phones
                            const wasteGrams = (model.waste * prompts * 365) / 1000;
                            rawCount = wasteGrams / 200;
                            unitName = "Phones/Year";
                        }

                        // Use same formatting as legend
                        const count = rawCount < 1 ? rawCount.toFixed(2) : Math.round(rawCount);

                        hoverLabel.innerHTML = `
                        <div style="display: flex; flex-direction: column; gap: 4px;">
                            <div style="font-weight: 700;">
                                <span style="color:${model.color}">â—</span> ${model.name}
                            </div>
                            <div style="font-size: 1.1rem; font-weight: 800; color: ${model.color};">
                                ${count} ${unitName}
                            </div>
                        </div>
                    `;
                        hoverLabel.style.left = event.clientX - container.getBoundingClientRect().left + 15 + "px";
                        hoverLabel.style.top = event.clientY - container.getBoundingClientRect().top - 10 + "px";
                        hoverLabel.style.opacity = "1";
                    }
                } else if (hoverLabel) {
                    hoverLabel.style.opacity = "0";
                }
            }

            function onMouseWheel(event) {
                event.preventDefault();
                const delta = event.deltaY > 0 ? 1.1 : 0.9;
                zoom3D(delta);
            }

            function updateCameraPosition() {
                if (!camera) return;

                const prompts = parseInt(document.getElementById("volSlider").value);

                const modelDisplayData = calculateObjectCounts(prompts);
                const numModels = modelDisplayData.length || 1;

                const distanceMultiplier = (1 + (numModels - 1) * 0.3) * zoomLevel;
                const baseDistance = THREE_CONFIG.camera.baseZ * distanceMultiplier;
                const baseHeight = THREE_CONFIG.camera.baseY * (1 + (numModels - 1) * 0.15) * zoomLevel;

                // Calculate new camera position based on rotation
                const x = Math.sin(cameraRotation.y) * baseDistance;
                const y = baseHeight + Math.sin(cameraRotation.x) * baseDistance * 0.5;
                const z = Math.cos(cameraRotation.y) * baseDistance;

                camera.position.set(x, Math.max(2, y), z);
                camera.lookAt(0, 0, 0);
            }

            function onWindowResize() {
                const container = document.getElementById("three-container");
                if (!container || !camera || !renderer) return;

                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            }

            function addLights() {
                const ambient = new THREE.AmbientLight(0xffffff, 0.6);
                scene.add(ambient);

                const mainLight = new THREE.DirectionalLight(0xffffff, 1.0);
                mainLight.position.set(10, 25, 15);
                mainLight.castShadow = true;
                scene.add(mainLight);

                const fillLight = new THREE.DirectionalLight(0x88ccff, 0.4);
                fillLight.position.set(-10, 15, -10);
                scene.add(fillLight);

                const backLight = new THREE.DirectionalLight(0xffffff, 0.3);
                backLight.position.set(0, 5, -20);
                scene.add(backLight);
            }

            function addGroundGrid() {
                //const gridHelper = new THREE.GridHelper(60, 60, 0x1a1a3a, 0x151528);
                //gridHelper.position.y = -0.5;
              //scene.add(gridHelper);

                const groundGeometry = new THREE.PlaneGeometry(80, 80);
                const groundMaterial = new THREE.MeshStandardMaterial({
                    color: 0x080818,
                    metalness: 0.2,
                    roughness: 0.8,
                    transparent: true,
                    opacity: 0.9
                });
                const ground = new THREE.Mesh(groundGeometry, groundMaterial);
                ground.rotation.x = -Math.PI / 2;
                ground.position.y = -0.51;
                ground.receiveShadow = true;
                scene.add(ground);
            }

            let animationTime = 0;
            function animate3D() {
                requestAnimationFrame(animate3D);
                animationTime += 0.016;

                laneGroups.forEach((group, groupIndex) => {
                    if (group) {
                        group.rotation.y += 0.002;

                        group.children.forEach((child, i) => {
                            if (activeSceneType === "energy" || activeSceneType === "water") {
                                const floatOffset = Math.sin(animationTime * 2 + i * 0.5) * 0.05;
                                child.position.y = (child.userData.baseY || 0) + floatOffset;
                            }
                        });
                    }
                });

                renderer.render(scene, camera);
            }

            function update3DMultiLane(tokenMultiplier) {
                clearOldObjects();

                if (activeModels.length === 0) {
                    updateLegend([]);
                    return;
                }

                const modelDisplayData = calculateObjectCounts(tokenMultiplier);
                const layout = calculateLaneLayout(modelDisplayData);

                // ~0 'é”Ÿçµ˜pé”Ÿ?é”Ÿæ–¤æ‹·)>
                const maxObjectCount = Math.max(...modelDisplayData.map((d) => d.count));

                createAllModelObjects(modelDisplayData, layout);
                adjustCamera(modelDisplayData.length, layout.laneWidth, maxObjectCount);
                updateLegend(modelDisplayData);
            }

            function clearOldObjects() {
                laneGroups.forEach((group) => {
                    if (group) {
                        scene.remove(group);
                        group.traverse((child) => {
                            if (child.geometry) child.geometry.dispose();
                            if (child.material) child.material.dispose();
                        });
                    }
                });
                laneGroups = [];
            }

            function calculateObjectCounts(prompts) {
                return activeModels.map((modelId) => {
                    const model = MODELS.find((m) => m.id === modelId);

                    let rawCount = 0;
                    switch (activeSceneType) {
                        case "energy":
                            // Wh per day / 60Wh per bulb = number of bulbs
                            rawCount = (model.energy * prompts) / 60;
                            break;
                        case "water":
                            // mL per day / 500mL per bottle = number of bottles
                            rawCount = (model.water * prompts) / 500;
                            break;
                        case "waste":
                            // mg per day * 365 / 1000 = g per year, / 200g per phone = phones
                            rawCount = (model.waste * prompts * 365) / 1000 / 200;
                            break;
                    }

                    // Ensure at least 1 object is shown if there's any usage
                    const displayCount = Math.min(Math.max(1, Math.ceil(rawCount)), THREE_CONFIG.maxObjects);

                    return {
                        model: model,
                        count: displayCount,
                        rawCount: rawCount
                    };
                });
            }

            function calculateLaneLayout(modelDisplayData) {
                const numModels = modelDisplayData.length;
                const maxCount = Math.max(...modelDisplayData.map((d) => d.count), 1);
                const gridSize = Math.ceil(Math.sqrt(maxCount));
                const laneWidth = gridSize * THREE_CONFIG.spacing + 2;
                const laneGap = Math.max(laneWidth, 6);
                const totalWidth = (numModels - 1) * laneGap;
                const startX = -totalWidth / 2;

                return { gridSize, laneWidth, laneGap, startX };
            }

            function createAllModelObjects(modelDisplayData, layout) {
                modelDisplayData.forEach((data, laneIndex) => {
                    const modelGroup = new THREE.Group();
                    modelGroup.position.x = layout.startX + laneIndex * layout.laneGap;

                    const colorHex = parseInt(data.model.color.replace("#", ""), 16);
                    placeObjectsInGrid(modelGroup, data.count, colorHex, layout.gridSize);

                    scene.add(modelGroup);
                    laneGroups.push(modelGroup);
                });
            }

            function placeObjectsInGrid(group, count, color, gridSize) {
                const spacing = THREE_CONFIG.spacing;

                // Calculate 3D cube dimensions
                const cubeSize = Math.ceil(Math.cbrt(count)); // Cube root for 3D grid
                const offset = ((cubeSize - 1) * spacing) / 2;

                let placed = 0;
                for (let y = 0; y < cubeSize && placed < count; y++) {
                    for (let z = 0; z < cubeSize && placed < count; z++) {
                        for (let x = 0; x < cubeSize && placed < count; x++) {
                            const object = createObject(color);

                            const posX = x * spacing - offset;
                            const posZ = z * spacing - offset;
                            const posY = y * spacing * 0.8; // Stack vertically with slight compression

                            if (activeSceneType === "waste") {
                                // Phones scattered with some randomness
                                object.position.set(
                                    posX + (Math.random() - 0.5) * 0.3,
                                    posY + (Math.random() - 0.5) * 0.2,
                                    posZ + (Math.random() - 0.5) * 0.3
                                );
                                object.rotation.set(
                                    (Math.random() - 0.5) * 0.4,
                                    Math.random() * Math.PI * 2,
                                    (Math.random() - 0.5) * 0.3
                                );
                            } else {
                                object.position.set(posX, posY, posZ);
                            }

                            object.userData.baseY = posY;
                            group.add(object);
                            placed++;
                        }
                    }
                }
            }

            function createObject(color) {
                switch (activeSceneType) {
                    case "energy":
                        return createBulb(color);
                    case "water":
                        return createBottle(color);
                    case "waste":
                        return createPhone(color);
                    default:
                        return createBulb(color);
                }
            }

            function adjustCamera(numModels, laneWidth, maxObjectCount = 0) {
                // 9n!é”Ÿçµ§è ˆé”Ÿçµ˜pé”Ÿæ–¤æ‹·tDé”Ÿ?èŽ¼
                const baseDistanceMultiplier = 1 + (numModels - 1) * 0.3;
                const baseHeightMultiplier = 1 + (numModels - 1) * 0.15;

                // 9né”Ÿçµ˜pé”Ÿæ–¤æ‹· etèŽ¼
                let objectCountFactor = 1;
                if (maxObjectCount > 50) {
                    objectCountFactor = 1 + (maxObjectCount - 50) / 100;
                }

                const distanceMultiplier = baseDistanceMultiplier * objectCountFactor * zoomLevel;
                const heightMultiplier = baseHeightMultiplier * Math.sqrt(objectCountFactor) * zoomLevel;

                camera.position.set(
                    0,
                    THREE_CONFIG.camera.baseY * heightMultiplier,
                    THREE_CONFIG.camera.baseZ * distanceMultiplier
                );
                camera.lookAt(0, 0, 0);
            }

            function zoom3D(factor) {
                zoomLevel *= factor;
                zoomLevel = Math.max(0.3, Math.min(3.0, zoomLevel)); // Clamp between 0.3x and 3x

                const prompts = parseInt(document.getElementById("volSlider").value);

                const modelDisplayData = calculateObjectCounts(prompts);
                const layout = calculateLaneLayout(modelDisplayData);
                const maxObjectCount = Math.max(...modelDisplayData.map((d) => d.count));
                adjustCamera(modelDisplayData.length, layout.laneWidth, maxObjectCount);
            }

            function resetZoom() {
                zoomLevel = 1.0;
                cameraRotation = { x: 0, y: 0 }; // Reset rotation
                const prompts = parseInt(document.getElementById("volSlider").value);

                const modelDisplayData = calculateObjectCounts(prompts);
                const layout = calculateLaneLayout(modelDisplayData);
                const maxObjectCount = Math.max(...modelDisplayData.map((d) => d.count));
                adjustCamera(modelDisplayData.length, layout.laneWidth, maxObjectCount);
            }

            function updateLegend(modelDisplayData) {
                const legendDiv = document.getElementById("laneLegend");
                const legend3D = document.getElementById("laneLegend3D");

                if (modelDisplayData.length === 0) {
                    legendDiv.innerHTML = '<div class="lane-badge">Select a model</div>';
                    if (legend3D) legend3D.innerHTML = '<div class="lane-badge">Select a model</div>';
                    // Update Impact Details table with current prompts
                    const prompts = parseInt(document.getElementById("volSlider").value) || 100;
                    updateImpactTable(prompts);
                    return;
                }

                // Get unit name based on current scene type
                const unitName = getUnitName();

                const legendHTML = modelDisplayData
                    .map((data) => {
                        // Format the count nicely - show decimal for small values
                        const displayValue = data.rawCount < 1 ? data.rawCount.toFixed(2) : Math.round(data.rawCount);
                        return `
                <div class="lane-badge" style="border-left-color: ${data.model.color}">
                    <span>${data.model.name}</span>
                    <span style="color: ${data.model.color}; font-weight: 700; margin-left: auto;">${displayValue} ${unitName}</span>
                </div>
            `;
                    })
                    .join("");

                legendDiv.innerHTML = legendHTML;
                if (legend3D) legend3D.innerHTML = legendHTML;

                // Update Impact Details table with current prompts
                const prompts = parseInt(document.getElementById("volSlider").value) || 100;
                updateImpactTable(prompts);
            }

            // Toggle Impact Details Panel
            function toggleImpactDetails() {
                const panel = document.getElementById("impactDetailsPanel");
                panel.classList.toggle("collapsed");
            }

            // Toggle Selected Models Panel
            function toggleSelectedModels() {
                const panel = document.getElementById("selectedModelsPanel");
                panel.classList.toggle("collapsed");
            }

            // Toggle Legend visibility
            let legendVisible = true;
            function toggleLegend() {
                legendVisible = !legendVisible;
                const legendContainer = document.getElementById("legendContainer");
                const legendContainerFS = document.getElementById("legendContainerFullscreen");
                const icon = document.getElementById("legendToggleIcon");
                const iconFS = document.getElementById("legendToggleIconFS");

                if (legendContainer) {
                    legendContainer.style.display = legendVisible ? "flex" : "none";
                }
                if (legendContainerFS) {
                    legendContainerFS.style.display = legendVisible ? "flex" : "none";
                }
                if (icon) {
                    icon.className = legendVisible ? "fas fa-list" : "fas fa-eye-slash";
                }
                if (iconFS) {
                    iconFS.className = legendVisible ? "fas fa-list" : "fas fa-eye-slash";
                }
            }

            function getUnitName() {
                switch (activeSceneType) {
                    case "energy":
                        return "bulbs";
                    case "water":
                        return "bottles";
                    case "waste":
                        return "phones";
                    default:
                        return "";
                }
            }

            // 3D Object Creators
            function createBulb(color) {
                const group = new THREE.Group();

                // Create a proper light bulb shape using lathe geometry
                const bulbPoints = [];
                // Bottom of bulb (where it connects to base)
                bulbPoints.push(new THREE.Vector2(0.08, 0));
                bulbPoints.push(new THREE.Vector2(0.12, 0.05));
                // Bulb body - pear shape
                bulbPoints.push(new THREE.Vector2(0.22, 0.15));
                bulbPoints.push(new THREE.Vector2(0.28, 0.3));
                bulbPoints.push(new THREE.Vector2(0.26, 0.45));
                bulbPoints.push(new THREE.Vector2(0.18, 0.55));
                // Top of bulb
                bulbPoints.push(new THREE.Vector2(0.08, 0.6));
                bulbPoints.push(new THREE.Vector2(0, 0.62));

                const bulbGeometry = new THREE.LatheGeometry(bulbPoints, 24);
                const glassMaterial = new THREE.MeshStandardMaterial({
                    color: color,
                    emissive: color,
                    emissiveIntensity: 0.6,
                    transparent: true,
                    opacity: 0.85,
                    metalness: 0.1,
                    roughness: 0.15
                });
                const bulbGlass = new THREE.Mesh(bulbGeometry, glassMaterial);

                // Inner glow
                const glowMaterial = new THREE.MeshBasicMaterial({ color: color, transparent: true, opacity: 0.25 });
                const innerGlow = new THREE.Mesh(new THREE.SphereGeometry(0.15, 12, 12), glowMaterial);
                innerGlow.position.y = 0.35;

                // Outer glow halo
                const outerGlow = new THREE.Mesh(
                    new THREE.SphereGeometry(0.35, 12, 12),
                    new THREE.MeshBasicMaterial({ color: color, transparent: true, opacity: 0.1 })
                );
                outerGlow.position.y = 0.35;

                // Filament inside the bulb
                const filamentMaterial = new THREE.MeshBasicMaterial({ color: 0xffdd88 });
                const filament = new THREE.Mesh(new THREE.CylinderGeometry(0.01, 0.01, 0.15, 6), filamentMaterial);
                filament.position.y = 0.3;

                // Metal screw base (Edison base)
                const baseMaterial = new THREE.MeshStandardMaterial({
                    color: 0x888888,
                    metalness: 0.95,
                    roughness: 0.2
                });
                const baseTop = new THREE.Mesh(new THREE.CylinderGeometry(0.1, 0.12, 0.08, 16), baseMaterial);
                baseTop.position.y = -0.04;

                // Screw threads
                const screwMaterial = new THREE.MeshStandardMaterial({
                    color: 0x666666,
                    metalness: 0.9,
                    roughness: 0.3
                });
                const screwBase = new THREE.Mesh(new THREE.CylinderGeometry(0.11, 0.09, 0.15, 16), screwMaterial);
                screwBase.position.y = -0.15;

                // Bottom contact
                const contactMaterial = new THREE.MeshStandardMaterial({
                    color: 0x333333,
                    metalness: 0.8,
                    roughness: 0.4
                });
                const contact = new THREE.Mesh(new THREE.CylinderGeometry(0.04, 0.04, 0.03, 8), contactMaterial);
                contact.position.y = -0.24;

                group.add(bulbGlass, innerGlow, outerGlow, filament, baseTop, screwBase, contact);
                return group;
            }

            function createBottle(color) {
                const group = new THREE.Group();

                const bodyMaterial = new THREE.MeshStandardMaterial({
                    color: color,
                    transparent: true,
                    opacity: 0.75,
                    metalness: 0.1,
                    roughness: 0.1
                });
                const body = new THREE.Mesh(new THREE.CylinderGeometry(0.15, 0.18, 0.55, 12), bodyMaterial);
                body.position.y = 0.275;

                const liquidMaterial = new THREE.MeshStandardMaterial({
                    color: color,
                    transparent: true,
                    opacity: 0.5,
                    emissive: color,
                    emissiveIntensity: 0.2
                });
                const liquid = new THREE.Mesh(new THREE.CylinderGeometry(0.13, 0.16, 0.5, 12), liquidMaterial);
                liquid.position.y = 0.25;

                const neck = new THREE.Mesh(new THREE.CylinderGeometry(0.06, 0.1, 0.12, 12), bodyMaterial);
                neck.position.y = 0.61;

                const capMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff, metalness: 0.3, roughness: 0.4 });
                const cap = new THREE.Mesh(new THREE.CylinderGeometry(0.08, 0.08, 0.06, 12), capMaterial);
                cap.position.y = 0.7;

                group.add(body, liquid, neck, cap);
                return group;
            }

            function createPhone(color) {
                const group = new THREE.Group();

                const bodyMaterial = new THREE.MeshStandardMaterial({
                    color: 0x1a1a1a,
                    metalness: 0.9,
                    roughness: 0.1
                });
                const body = new THREE.Mesh(new THREE.BoxGeometry(0.35, 0.04, 0.7), bodyMaterial);

                const screenMaterial = new THREE.MeshBasicMaterial({ color: color });
                const screen = new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.045, 0.6), screenMaterial);
                screen.position.y = 0.005;

                const screenGlow = new THREE.Mesh(
                    new THREE.PlaneGeometry(0.32, 0.62),
                    new THREE.MeshBasicMaterial({
                        color: color,
                        transparent: true,
                        opacity: 0.3,
                        side: THREE.DoubleSide
                    })
                );
                screenGlow.rotation.x = -Math.PI / 2;
                screenGlow.position.y = 0.025;

                const cameraMaterial = new THREE.MeshStandardMaterial({
                    color: 0x333333,
                    metalness: 0.8,
                    roughness: 0.2
                });
                const phoneCam = new THREE.Mesh(new THREE.CylinderGeometry(0.02, 0.02, 0.01, 8), cameraMaterial);
                phoneCam.position.set(0.1, -0.02, 0.25);
                phoneCam.rotation.x = Math.PI / 2;

                group.add(body, screen, screenGlow, phoneCam);
                return group;
            }

            // --- UTILS ---
            function switchTab(id, btn) {
                document.querySelectorAll(".view-section").forEach((e) => e.classList.remove("active"));
                document.getElementById(id).classList.add("active");
                document.querySelectorAll(".nav-btn").forEach((e) => e.classList.remove("active"));
                btn.classList.add("active");
                if (id === "benchmarks") {
                    if (!threeInitialized) {
                        setTimeout(initThree, 100);
                    } else {
                        // Resize renderer when switching back to 3D view
                        // This fixes the issue where the 3D canvas doesn't display properly
                        // after being hidden (container dimensions were 0 when hidden)
                        setTimeout(onWindowResize, 50);
                        // Update the 3D scene and Impact Details table with current data
                        const prompts = parseInt(document.getElementById("volSlider").value);
                        update3DMultiLane(prompts);
                    }
                }
            }

            function switch3DScene(type, btn) {
                activeSceneType = type;
                document.querySelectorAll(".t-btn").forEach((b) => b.classList.remove("active"));
                btn.classList.add("active");

                const titles = {
                    energy: { title: "ENERGY", subtitle: "Each bulb = 60Wh" },
                    water: { title: "WATER", subtitle: "Each bottle = 500mL (0.5L)" },
                    waste: { title: "E-WASTE", subtitle: "Each phone = 200g (0.2kg)" }
                };

                const unitLabels = {
                    energy: "Wh = watt-hours",
                    water: "L = liters",
                    waste: "kg = kilograms"
                };

                document.getElementById("metaTitle").innerText = titles[type].title;
                document.getElementById("metaSubtitle").innerText = titles[type].subtitle;

                updateDashboard();
            }

            // Model resource links
            const MODEL_LINKS = {
                "mistral": "https://mistral.ai/",
                "gpt35": "https://platform.openai.com/docs/models/gpt-3-5-turbo",
                "claude": "https://www.anthropic.com/claude",
                "claude-opus": "https://www.anthropic.com/claude",
                "gpt4": "https://platform.openai.com/docs/models/gpt-4o",
                "gpt4turbo": "https://platform.openai.com/docs/models",
                "gemini-pro": "https://deepmind.google/technologies/gemini/",
                "gemini-flash": "https://deepmind.google/technologies/gemini/",
                "llama3": "https://llama.meta.com/",
                "dalle": "https://openai.com/dall-e-3",
                "midjourney": "https://www.midjourney.com/",
                "stable-diff": "https://stability.ai/"
            };

            function showDetails(id) {
                const m = MODELS.find((x) => x.id === id);
                document.getElementById("mName").innerText = m.name;
                document.getElementById("mDesc").innerText = m.desc || "AI model";
                // Show per-prompt values (energy: Wh, water: mL, waste: mg)
                document.getElementById("mEnergy").innerText = m.energy.toFixed(2);
                document.getElementById("mWater").innerText = m.water.toFixed(0);
                document.getElementById("mWaste").innerText = m.waste.toFixed(1);

                // Update model link
                const linkEl = document.getElementById("mLink");
                if (MODEL_LINKS[id]) {
                    linkEl.href = MODEL_LINKS[id];
                    linkEl.parentElement.style.display = "block";
                } else {
                    linkEl.parentElement.style.display = "none";
                }

                document.getElementById("detailModal").classList.add("open");

                document.querySelector(".modal-close").focus();
            }

            function closeModal() {
                document.getElementById("detailModal").classList.remove("open");
            }

            function goToHome() {
                // Show the landing/intro page
                const landing = document.getElementById("landing-layer");
                const appContainer = document.getElementById("app-container");
                landing.classList.remove("hidden");
                appContainer.classList.remove("visible");
            }

            function togglePromptHelp() {
                const content = document.getElementById("promptHelpContent");
                const icon = document.getElementById("promptHelpIcon");
                if (content.style.display === "none") {
                    content.style.display = "block";
                    icon.style.transform = "rotate(180deg)";
                } else {
                    content.style.display = "none";
                    icon.style.transform = "rotate(0deg)";
                }
            }

            window.addEventListener("load", () => {
                init();
                initLandingParticles();
                init3DBrain();

                // é©å­˜å¸´ç¼æ¬å¯œé–½î†½åŠé”çŠµå£é‘è®³ç°¨æµ ?                const exploreBtn = document.getElementById("exploreBtn");
                if (exploreBtn) {
                    exploreBtn.addEventListener("click", function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        enterApp();
                    });
                }
            });
        </script>
    </body>
</html>

